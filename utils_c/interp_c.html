<!-- Generated by Cython 0.15.1 on Sat Feb  4 11:11:31 2012 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.15.1 on Sat Feb  4 11:11:31 2012
<p>Raw output: <a href="interp_c.c">interp_c.c</a>
<pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line1")'> 1: """</pre>
<pre id='line1' class='code' style='background-color: #FFFF62'>
  /* "unicorn/utils_c/interp_c.pyx":1
 * """             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * Pythonic utilities ported to C [Cython] for speedup.
 * """
 */
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_kp_u_19), ((PyObject *)__pyx_kp_u_20)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_2)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: Pythonic utilities ported to C [Cython] for speedup.</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: """</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line4")'> 4: import numpy as np</pre>
<pre id='line4' class='code' style='background-color: #FFFF8d'>
  /* "unicorn/utils_c/interp_c.pyx":4
 * Pythonic utilities ported to C [Cython] for speedup.
 * """
 * import numpy as np             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cimport numpy as np
 * DTYPE = np.double
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__np, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 4; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: cimport numpy as np</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line6")'> 6: DTYPE = np.double</pre>
<pre id='line6' class='code' style='background-color: #FFFF6a'>
  /* "unicorn/utils_c/interp_c.pyx":6
 * import numpy as np
 * cimport numpy as np
 * DTYPE = np.double             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * ctypedef np.double_t DTYPE_t
 * ctypedef np.uint_t UINT_t
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__double);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__DTYPE, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: ctypedef np.double_t DTYPE_t</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'>
/* "unicorn/utils_c/interp_c.pyx":7
 * cimport numpy as np
 * DTYPE = np.double
 * ctypedef np.double_t DTYPE_t             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * ctypedef np.uint_t UINT_t
 * 
 */
typedef __pyx_t_5numpy_double_t __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: ctypedef np.uint_t UINT_t</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: </pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: import cython</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: </pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12: @cython.boundscheck(False)</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line13")'> 13: def interp_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] xp, np.ndarray[DTYPE_t, ndim=1] fp, double extrapolate=0., short int assume_sorted=1):</pre>
<pre id='line13' class='code' style='background-color: #FFFF18'>
/* "unicorn/utils_c/interp_c.pyx":13
 * 
 * @cython.boundscheck(False)
 * def interp_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] xp, np.ndarray[DTYPE_t, ndim=1] fp, double extrapolate=0., short int assume_sorted=1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     interp_c(x, xp, fp, extrapolate=0., assume_sorted=0)
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_interp_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7unicorn_7utils_c_8interp_c_interp_c[] = "\n    interp_c(x, xp, fp, extrapolate=0., assume_sorted=0)\n    \n    Fast interpolation: [`xp`, `fp`] interpolated at `x`.\n    \n    Extrapolated values are set to `extrapolate`.\n    \n    The default `assume_sorted`=1 assumes that the `x` array is sorted and single-\n    valued, providing a significant gain in speed. (xp is always assumed to be sorted)\n    \n    ";
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_interp_c = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("interp_c"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_interp_c, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_7unicorn_7utils_c_8interp_c_interp_c)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_interp_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_xp = 0;
  PyArrayObject *__pyx_v_fp = 0;
  double __pyx_v_extrapolate;
  short __pyx_v_assume_sorted;
  unsigned long __pyx_v_i;
  unsigned long __pyx_v_j;
  unsigned long __pyx_v_N;
  unsigned long __pyx_v_Np;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_x1;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_x2;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_y1;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_y2;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_out;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_xval;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_xmin;
  PyArrayObject *__pyx_v_f = 0;
  Py_buffer __pyx_bstruct_fp;
  Py_ssize_t __pyx_bstride_0_fp = 0;
  Py_ssize_t __pyx_bshape_0_fp = 0;
  Py_buffer __pyx_bstruct_f;
  Py_ssize_t __pyx_bstride_0_f = 0;
  Py_ssize_t __pyx_bshape_0_f = 0;
  Py_buffer __pyx_bstruct_x;
  Py_ssize_t __pyx_bstride_0_x = 0;
  Py_ssize_t __pyx_bshape_0_x = 0;
  Py_buffer __pyx_bstruct_xp;
  Py_ssize_t __pyx_bstride_0_xp = 0;
  Py_ssize_t __pyx_bshape_0_xp = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__x,&__pyx_n_s__xp,&__pyx_n_s__fp,&__pyx_n_s__extrapolate,&__pyx_n_s__assume_sorted,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("interp_c");
  __pyx_self = __pyx_self;
  {
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__x);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__xp);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_c", 0, 3, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__fp);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_c", 0, 3, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__extrapolate);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__assume_sorted);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "interp_c") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_xp = ((PyArrayObject *)values[1]);
    __pyx_v_fp = ((PyArrayObject *)values[2]);
    if (values[3]) {
      __pyx_v_extrapolate = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_extrapolate == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_extrapolate = ((double)0.);
    }
    if (values[4]) {
      __pyx_v_assume_sorted = __Pyx_<span class='py_c_api'>PyInt_AsShort</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_assume_sorted == (short)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_assume_sorted = ((short)1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_c", 0, 3, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_f.buf = NULL;
  __pyx_bstruct_x.buf = NULL;
  __pyx_bstruct_xp.buf = NULL;
  __pyx_bstruct_fp.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_xp), __pyx_ptype_5numpy_ndarray, 1, "xp", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_fp), __pyx_ptype_5numpy_ndarray, 1, "fp", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_x, (PyObject*)__pyx_v_x, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_x = __pyx_bstruct_x.strides[0];
  __pyx_bshape_0_x = __pyx_bstruct_x.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_xp, (PyObject*)__pyx_v_xp, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_xp = __pyx_bstruct_xp.strides[0];
  __pyx_bshape_0_xp = __pyx_bstruct_xp.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_fp, (PyObject*)__pyx_v_fp, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_fp = __pyx_bstruct_fp.strides[0];
  __pyx_bshape_0_fp = __pyx_bstruct_fp.shape[0];

  /* "unicorn/utils_c/interp_c.pyx":13
 * 
 * @cython.boundscheck(False)
 * def interp_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] xp, np.ndarray[DTYPE_t, ndim=1] fp, double extrapolate=0., short int assume_sorted=1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     interp_c(x, xp, fp, extrapolate=0., assume_sorted=0)
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_interp_c, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__interp_c, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14:     """</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15:     interp_c(x, xp, fp, extrapolate=0., assume_sorted=0)</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16: </pre>
<pre id='line16' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17:     Fast interpolation: [`xp`, `fp`] interpolated at `x`.</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: </pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19:     Extrapolated values are set to `extrapolate`.</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: </pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21:     The default `assume_sorted`=1 assumes that the `x` array is sorted and single-</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22:     valued, providing a significant gain in speed. (xp is always assumed to be sorted)</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: </pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24:     """</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25:     cdef unsigned long i, j, N, Np</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26:     cdef DTYPE_t x1,x2,y1,y2,out</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27:     cdef DTYPE_t fout, xval, xmin</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: </pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line29")'> 29:     N, Np = len(x), len(xp)</pre>
<pre id='line29' class='code' style='background-color: #FFFF7f'>
  /* "unicorn/utils_c/interp_c.pyx":29
 *     cdef DTYPE_t fout, xval, xmin
 * 
 *     N, Np = len(x), len(xp)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef np.ndarray[DTYPE_t, ndim=1] f = np.zeros(N)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_x));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_xp));<span class='error_goto'> if (unlikely(__pyx_t_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_N = __pyx_t_1;
  __pyx_v_Np = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF3e' onclick='toggleDiv("line30")'> 30:     cdef np.ndarray[DTYPE_t, ndim=1] f = np.zeros(N)</pre>
<pre id='line30' class='code' style='background-color: #FFFF3e'>
  /* "unicorn/utils_c/interp_c.pyx":30
 * 
 *     N, Np = len(x), len(xp)
 *     cdef np.ndarray[DTYPE_t, ndim=1] f = np.zeros(N)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     i=0
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_f, (PyObject*)__pyx_t_6, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_f = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_bstruct_f.buf = NULL;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_bstride_0_f = __pyx_bstruct_f.strides[0];
      __pyx_bshape_0_f = __pyx_bstruct_f.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_f = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: </pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:     i=0</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":32
 *     cdef np.ndarray[DTYPE_t, ndim=1] f = np.zeros(N)
 * 
 *     i=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     j=0
 *     ### Handle left extrapolation
 */
  __pyx_v_i = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33:     j=0</pre>
<pre id='line33' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":33
 * 
 *     i=0
 *     j=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     ### Handle left extrapolation
 *     xmin = xp[0]
 */
  __pyx_v_j = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34:     ### Handle left extrapolation</pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35:     xmin = xp[0]</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":35
 *     j=0
 *     ### Handle left extrapolation
 *     xmin = xp[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if assume_sorted == 1:
 *         while x[j] <code><</code> xmin:
 */
  __pyx_t_7 = 0;
  if (__pyx_t_7 <code><</code> 0) __pyx_t_7 += __pyx_bshape_0_xp;
  __pyx_v_xmin = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_xp.buf, __pyx_t_7, __pyx_bstride_0_xp));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36:     if assume_sorted == 1:</pre>
<pre id='line36' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":36
 *     ### Handle left extrapolation
 *     xmin = xp[0]
 *     if assume_sorted == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         while x[j] <code><</code> xmin:
 *             f[j] = extrapolate
 */
  __pyx_t_8 = (__pyx_v_assume_sorted == 1);
  if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:         while x[j] &lt; xmin:</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":37
 *     xmin = xp[0]
 *     if assume_sorted == 1:
 *         while x[j] <code><</code> xmin:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             f[j] = extrapolate
 *             j+=1
 */
    while (1) {
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_8 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_9, __pyx_bstride_0_x)) <code><</code> __pyx_v_xmin);
      if (!__pyx_t_8) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:             f[j] = extrapolate</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":38
 *     if assume_sorted == 1:
 *         while x[j] <code><</code> xmin:
 *             f[j] = extrapolate             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             j+=1
 * 
 */
      __pyx_t_10 = __pyx_v_j;
      *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_f.buf, __pyx_t_10, __pyx_bstride_0_f) = __pyx_v_extrapolate;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:             j+=1</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":39
 *         while x[j] <code><</code> xmin:
 *             f[j] = extrapolate
 *             j+=1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     while j <code><</code> N:
 */
      __pyx_v_j = (__pyx_v_j + 1);
    }
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40: </pre>
<pre id='line40' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:     while j &lt; N:</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":41
 *             j+=1
 * 
 *     while j <code><</code> N:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         xval = x[j]
 *         if assume_sorted == 0:
 */
  while (1) {
    __pyx_t_8 = (__pyx_v_j <code><</code> __pyx_v_N);
    if (!__pyx_t_8) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:         xval = x[j]</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":42
 * 
 *     while j <code><</code> N:
 *         xval = x[j]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if assume_sorted == 0:
 *             if x[j] <code><</code> xmin:
 */
    __pyx_t_11 = __pyx_v_j;
    __pyx_v_xval = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_11, __pyx_bstride_0_x));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:         if assume_sorted == 0:</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":43
 *     while j <code><</code> N:
 *         xval = x[j]
 *         if assume_sorted == 0:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if x[j] <code><</code> xmin:
 *                 f[j] = extrapolate
 */
    __pyx_t_8 = (__pyx_v_assume_sorted == 0);
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:             if x[j] &lt; xmin:</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":44
 *         xval = x[j]
 *         if assume_sorted == 0:
 *             if x[j] <code><</code> xmin:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 f[j] = extrapolate
 *                 j+=1
 */
      __pyx_t_12 = __pyx_v_j;
      __pyx_t_8 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_12, __pyx_bstride_0_x)) <code><</code> __pyx_v_xmin);
      if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:                 f[j] = extrapolate</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":45
 *         if assume_sorted == 0:
 *             if x[j] <code><</code> xmin:
 *                 f[j] = extrapolate             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 j+=1
 *                 continue
 */
        __pyx_t_13 = __pyx_v_j;
        *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_f.buf, __pyx_t_13, __pyx_bstride_0_f) = __pyx_v_extrapolate;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:                 j+=1</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":46
 *             if x[j] <code><</code> xmin:
 *                 f[j] = extrapolate
 *                 j+=1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 continue
 *             else:
 */
        __pyx_v_j = (__pyx_v_j + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:                 continue</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":47
 *                 f[j] = extrapolate
 *                 j+=1
 *                 continue             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 i=0
 */
        goto __pyx_L9_continue;
        goto __pyx_L12;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:             else:</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:                 i=0</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":49
 *                 continue
 *             else:
 *                 i=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         while (xp[i] <code><</code> xval) & (i <code><</code> Np-1): i+=1;
 *         if i == (Np-1):
 */
        __pyx_v_i = 0;
      }
      __pyx_L12:;
      goto __pyx_L11;
    }
    __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50:         while (xp[i] &lt; xval) &amp; (i &lt; Np-1): i+=1;</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":50
 *             else:
 *                 i=0
 *         while (xp[i] <code><</code> xval) & (i <code><</code> Np-1): i+=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         if i == (Np-1):
 *             if x[j] != xp[i]:
 */
    while (1) {
      __pyx_t_14 = __pyx_v_i;
      __pyx_t_8 = (((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_xp.buf, __pyx_t_14, __pyx_bstride_0_xp)) <code><</code> __pyx_v_xval) & (__pyx_v_i <code><</code> (__pyx_v_Np - 1)));
      if (!__pyx_t_8) break;
      __pyx_v_i = (__pyx_v_i + 1);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:         if i == (Np-1):</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":51
 *                 i=0
 *         while (xp[i] <code><</code> xval) & (i <code><</code> Np-1): i+=1;
 *         if i == (Np-1):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             if x[j] != xp[i]:
 *                 f[j] = extrapolate
 */
    __pyx_t_8 = (__pyx_v_i == (__pyx_v_Np - 1));
    if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:             if x[j] != xp[i]:</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":52
 *         while (xp[i] <code><</code> xval) & (i <code><</code> Np-1): i+=1;
 *         if i == (Np-1):
 *             if x[j] != xp[i]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 f[j] = extrapolate
 *             else:
 */
      __pyx_t_15 = __pyx_v_j;
      __pyx_t_16 = __pyx_v_i;
      __pyx_t_8 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_15, __pyx_bstride_0_x)) != (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_xp.buf, __pyx_t_16, __pyx_bstride_0_xp)));
      if (__pyx_t_8) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:                 f[j] = extrapolate</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":53
 *         if i == (Np-1):
 *             if x[j] != xp[i]:
 *                 f[j] = extrapolate             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 f[j] = fp[i]
 */
        __pyx_t_17 = __pyx_v_j;
        *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_f.buf, __pyx_t_17, __pyx_bstride_0_f) = __pyx_v_extrapolate;
        goto __pyx_L16;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:             else:</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:                 f[j] = fp[i]</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":55
 *                 f[j] = extrapolate
 *             else:
 *                 f[j] = fp[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             j+=1
 *             continue
 */
        __pyx_t_18 = __pyx_v_i;
        __pyx_t_19 = __pyx_v_j;
        *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_f.buf, __pyx_t_19, __pyx_bstride_0_f) = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_fp.buf, __pyx_t_18, __pyx_bstride_0_fp));
      }
      __pyx_L16:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:             j+=1</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":56
 *             else:
 *                 f[j] = fp[i]
 *             j+=1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             continue
 *         #### x[i] is now greater than xval because the
 */
      __pyx_v_j = (__pyx_v_j + 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57:             continue</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":57
 *                 f[j] = fp[i]
 *             j+=1
 *             continue             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         #### x[i] is now greater than xval because the
 *         #### expression (x[i]<code><</code>xval) is false, assuming
 */
      goto __pyx_L9_continue;
      goto __pyx_L15;
    }
    __pyx_L15:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58:         #### x[i] is now greater than xval because the</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59:         #### expression (x[i]&lt;xval) is false, assuming</pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60:         #### that xval &lt; max(x).</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line61")'> 61: </pre>
<pre id='line61' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62:         x1 = xp[i];</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":62
 *         #### that xval <code><</code> max(x).
 * 
 *         x1 = xp[i];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         x2 = xp[i+1];
 *         y1 = fp[i];
 */
    __pyx_t_20 = __pyx_v_i;
    __pyx_v_x1 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_xp.buf, __pyx_t_20, __pyx_bstride_0_xp));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63:         x2 = xp[i+1];</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":63
 * 
 *         x1 = xp[i];
 *         x2 = xp[i+1];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         y1 = fp[i];
 *         y2 = fp[i+1];
 */
    __pyx_t_21 = (__pyx_v_i + 1);
    __pyx_v_x2 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_xp.buf, __pyx_t_21, __pyx_bstride_0_xp));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:         y1 = fp[i];</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":64
 *         x1 = xp[i];
 *         x2 = xp[i+1];
 *         y1 = fp[i];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         y2 = fp[i+1];
 *         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;
 */
    __pyx_t_22 = __pyx_v_i;
    __pyx_v_y1 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_fp.buf, __pyx_t_22, __pyx_bstride_0_fp));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:         y2 = fp[i+1];</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":65
 *         x2 = xp[i+1];
 *         y1 = fp[i];
 *         y2 = fp[i+1];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;
 *         f[j] = out
 */
    __pyx_t_23 = (__pyx_v_i + 1);
    __pyx_v_y2 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_fp.buf, __pyx_t_23, __pyx_bstride_0_fp));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line66")'> 66:         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;</pre>
<pre id='line66' class='code' style='background-color: #FFFFaa'>
    /* "unicorn/utils_c/interp_c.pyx":66
 *         y1 = fp[i];
 *         y2 = fp[i+1];
 *         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         f[j] = out
 *         j+=1
 */
    __pyx_t_24 = (__pyx_v_y2 - __pyx_v_y1);
    __pyx_t_25 = (__pyx_v_x2 - __pyx_v_x1);
    if (unlikely(__pyx_t_25 == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_out = (((__pyx_t_24 / __pyx_t_25) * (__pyx_v_xval - __pyx_v_x1)) + __pyx_v_y1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:         f[j] = out</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":67
 *         y2 = fp[i+1];
 *         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;
 *         f[j] = out             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         j+=1
 * 
 */
    __pyx_t_26 = __pyx_v_j;
    *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_f.buf, __pyx_t_26, __pyx_bstride_0_f) = __pyx_v_out;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:         j+=1</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":68
 *         out = ((y2-y1)/(x2-x1))*(xval-x1)+y1;
 *         f[j] = out
 *         j+=1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return f
 */
    __pyx_v_j = (__pyx_v_j + 1);
    __pyx_L9_continue:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69: </pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3f' onclick='toggleDiv("line70")'> 70:     return f</pre>
<pre id='line70' class='code' style='background-color: #FFFF3f'>
  /* "unicorn/utils_c/interp_c.pyx":70
 *         j+=1
 * 
 *     return f             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_f));
  __pyx_r = ((PyObject *)__pyx_v_f);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_fp);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_f);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_xp);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_fp);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_f);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_xp);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_f);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: </pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72: #</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1e' onclick='toggleDiv("line73")'> 73: def interp_conserve(x, xp, fp, left=0., right=0.):</pre>
<pre id='line73' class='code' style='background-color: #FFFF1e'>
/* "unicorn/utils_c/interp_c.pyx":73
 * 
 * #
 * def interp_conserve(x, xp, fp, left=0., right=0.):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     Interpolate `xp`,`yp` array to the output x array, conserving flux.
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_1interp_conserve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7unicorn_7utils_c_8interp_c_1interp_conserve[] = "\n    Interpolate `xp`,`yp` array to the output x array, conserving flux.  \n    `xp` can be irregularly spaced.\n    ";
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_1interp_conserve = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("interp_conserve"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_1interp_conserve, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_7unicorn_7utils_c_8interp_c_1interp_conserve)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_1interp_conserve(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_xp = 0;
  PyObject *__pyx_v_fp = 0;
  PyObject *__pyx_v_left = 0;
  PyObject *__pyx_v_right = 0;
  PyArrayObject *__pyx_v_fullx = 0;
  PyArrayObject *__pyx_v_fully = 0;
  PyArrayObject *__pyx_v_so = 0;
  PyArrayObject *__pyx_v_outy = 0;
  PyArrayObject *__pyx_v_dx = 0;
  long __pyx_v_i;
  PyObject *__pyx_v_midpoint = NULL;
  PyObject *__pyx_v_int_midpoint = NULL;
  PyObject *__pyx_v_bin = NULL;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__x,&__pyx_n_s__xp,&__pyx_n_s__fp,&__pyx_n_s__left,&__pyx_n_s__right,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("interp_conserve");
  __pyx_self = __pyx_self;
  {
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = __pyx_k_1;
    values[4] = __pyx_k_2;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__x);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__xp);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve", 0, 3, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__fp);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve", 0, 3, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__left);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__right);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "interp_conserve") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = values[0];
    __pyx_v_xp = values[1];
    __pyx_v_fp = values[2];
    __pyx_v_left = values[3];
    __pyx_v_right = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve", 0, 3, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_conserve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "unicorn/utils_c/interp_c.pyx":73
 * 
 * #
 * def interp_conserve(x, xp, fp, left=0., right=0.):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     Interpolate `xp`,`yp` array to the output x array, conserving flux.
 */
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_k_1 = __pyx_t_2;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_k_2 = __pyx_t_2;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_1interp_conserve, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__interp_conserve, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:     """</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line75")'> 75:     Interpolate `xp`,`yp` array to the output x array, conserving flux.</pre>
<pre id='line75' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:     `xp` can be irregularly spaced.</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:     """</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78:     cdef np.ndarray fullx, fully, so, outy, dx</pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:     cdef long N, i</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80: </pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line81")'> 81:     midpoint = (x[1:]-x[:-1])/2.+x[:-1]</pre>
<pre id='line81' class='code' style='background-color: #FFFF32'>
  /* "unicorn/utils_c/interp_c.pyx":81
 *     cdef long N, i
 * 
 *     midpoint = (x[1:]-x[:-1])/2.+x[:-1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     midpoint = np.append(midpoint, np.array([x[0],x[-1]]))
 *     midpoint = midpoint[np.argsort(midpoint)]
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_x, 1, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_x, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(2.);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_x, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_midpoint = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line82")'> 82:     midpoint = np.append(midpoint, np.array([x[0],x[-1]]))</pre>
<pre id='line82' class='code' style='background-color: #FFFF26'>
  /* "unicorn/utils_c/interp_c.pyx":82
 * 
 *     midpoint = (x[1:]-x[:-1])/2.+x[:-1]
 *     midpoint = np.append(midpoint, np.array([x[0],x[-1]]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     midpoint = midpoint[np.argsort(midpoint)]
 *     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__append);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x, -1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_midpoint);
  __pyx_v_midpoint = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line83")'> 83:     midpoint = midpoint[np.argsort(midpoint)]</pre>
<pre id='line83' class='code' style='background-color: #FFFF41'>
  /* "unicorn/utils_c/interp_c.pyx":83
 *     midpoint = (x[1:]-x[:-1])/2.+x[:-1]
 *     midpoint = np.append(midpoint, np.array([x[0],x[-1]]))
 *     midpoint = midpoint[np.argsort(midpoint)]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)
 *     int_midpoint[midpoint > xp.max()] = 0.
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_5, __pyx_n_s__argsort);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_midpoint);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_midpoint, __pyx_t_2);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_midpoint);
  __pyx_v_midpoint = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line84")'> 84:     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)</pre>
<pre id='line84' class='code' style='background-color: #FFFF31'>
  /* "unicorn/utils_c/interp_c.pyx":84
 *     midpoint = np.append(midpoint, np.array([x[0],x[-1]]))
 *     midpoint = midpoint[np.argsort(midpoint)]
 *     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int_midpoint[midpoint > xp.max()] = 0.
 *     int_midpoint[midpoint <code><</code> xp.min()] = 0.
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_5, __pyx_n_s__interp);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_midpoint);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_xp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_v_xp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_xp);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_v_fp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_fp);
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__left), __pyx_v_left) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__right), __pyx_v_right) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_2, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_v_int_midpoint = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line85")'> 85:     int_midpoint[midpoint &gt; xp.max()] = 0.</pre>
<pre id='line85' class='code' style='background-color: #FFFF41'>
  /* "unicorn/utils_c/interp_c.pyx":85
 *     midpoint = midpoint[np.argsort(midpoint)]
 *     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)
 *     int_midpoint[midpoint > xp.max()] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     int_midpoint[midpoint <code><</code> xp.min()] = 0.
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_xp, __pyx_n_s__max);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_midpoint, __pyx_t_5, Py_GT);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_int_midpoint, __pyx_t_4, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line86")'> 86:     int_midpoint[midpoint &lt; xp.min()] = 0.</pre>
<pre id='line86' class='code' style='background-color: #FFFF41'>
  /* "unicorn/utils_c/interp_c.pyx":86
 *     int_midpoint = np.interp(midpoint, xp, fp, left=left, right=right)
 *     int_midpoint[midpoint > xp.max()] = 0.
 *     int_midpoint[midpoint <code><</code> xp.min()] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     fullx = np.append(xp, midpoint)
 */
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_xp, __pyx_n_s__min);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_empty_tuple), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_midpoint, __pyx_t_5, Py_LT);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyObject_SetItem</span>(__pyx_v_int_midpoint, __pyx_t_4, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line87")'> 87: </pre>
<pre id='line87' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line88")'> 88:     fullx = np.append(xp, midpoint)</pre>
<pre id='line88' class='code' style='background-color: #FFFF46'>
  /* "unicorn/utils_c/interp_c.pyx":88
 *     int_midpoint[midpoint <code><</code> xp.min()] = 0.
 * 
 *     fullx = np.append(xp, midpoint)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     fully = np.append(fp, int_midpoint)
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__append);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_xp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_v_xp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_xp);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_v_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_midpoint);
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_fullx = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line89")'> 89:     fully = np.append(fp, int_midpoint)</pre>
<pre id='line89' class='code' style='background-color: #FFFF46'>
  /* "unicorn/utils_c/interp_c.pyx":89
 * 
 *     fullx = np.append(xp, midpoint)
 *     fully = np.append(fp, int_midpoint)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     so = np.argsort(fullx)
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_5, __pyx_n_s__append);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_fp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_fp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_fp);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_int_midpoint);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_v_int_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_int_midpoint);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_fully = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: </pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line91")'> 91:     so = np.argsort(fullx)</pre>
<pre id='line91' class='code' style='background-color: #FFFF4b'>
  /* "unicorn/utils_c/interp_c.pyx":91
 *     fully = np.append(fp, int_midpoint)
 * 
 *     so = np.argsort(fullx)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     fullx, fully = fullx[so], fully[so]
 * 
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_4, __pyx_n_s__argsort);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_fullx));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_fullx));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_fullx));
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 91; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_so = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line92")'> 92:     fullx, fully = fullx[so], fully[so]</pre>
<pre id='line92' class='code' style='background-color: #FFFF62'>
  /* "unicorn/utils_c/interp_c.pyx":92
 * 
 *     so = np.argsort(fullx)
 *     fullx, fully = fullx[so], fully[so]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     outy = x*0.
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_fullx), ((PyObject *)__pyx_v_so));<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_fully), ((PyObject *)__pyx_v_so));<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_fullx));
  __pyx_v_fullx = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_fully));
  __pyx_v_fully = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93: </pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF6e' onclick='toggleDiv("line94")'> 94:     outy = x*0.</pre>
<pre id='line94' class='code' style='background-color: #FFFF6e'>
  /* "unicorn/utils_c/interp_c.pyx":94
 *     fullx, fully = fullx[so], fully[so]
 * 
 *     outy = x*0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     dx = midpoint[1:]-midpoint[:-1]
 *     for i in range(len(x)):
 */
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_x, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_outy = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line95")'> 95:     dx = midpoint[1:]-midpoint[:-1]</pre>
<pre id='line95' class='code' style='background-color: #FFFF57'>
  /* "unicorn/utils_c/interp_c.pyx":95
 * 
 *     outy = x*0.
 *     dx = midpoint[1:]-midpoint[:-1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i in range(len(x)):
 *         bin = (fullx >= midpoint[i]) & (fullx <code><</code>= midpoint[i+1])
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_midpoint, 1, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_midpoint, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_1, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_dx = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line96")'> 96:     for i in range(len(x)):</pre>
<pre id='line96' class='code' style='background-color: #FFFFaa'>
  /* "unicorn/utils_c/interp_c.pyx":96
 *     outy = x*0.
 *     dx = midpoint[1:]-midpoint[:-1]
 *     for i in range(len(x)):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         bin = (fullx >= midpoint[i]) & (fullx <code><</code>= midpoint[i+1])
 *         outy[i] = np.trapz(fully[bin], fullx[bin])/dx[i]
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_x);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  for (__pyx_t_7 = 0; __pyx_t_7 <code><</code> __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_i = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF4b' onclick='toggleDiv("line97")'> 97:         bin = (fullx &gt;= midpoint[i]) &amp; (fullx &lt;= midpoint[i+1])</pre>
<pre id='line97' class='code' style='background-color: #FFFF4b'>
    /* "unicorn/utils_c/interp_c.pyx":97
 *     dx = midpoint[1:]-midpoint[:-1]
 *     for i in range(len(x)):
 *         bin = (fullx >= midpoint[i]) & (fullx <code><</code>= midpoint[i+1])             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         outy[i] = np.trapz(fully[bin], fullx[bin])/dx[i]
 * 
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_midpoint, __pyx_v_i, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_4 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_fullx), __pyx_t_5, Py_GE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_8 = (__pyx_v_i + 1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_midpoint, __pyx_t_8, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(((PyObject *)__pyx_v_fullx), __pyx_t_5, Py_LE);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyNumber_And</span>(__pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_bin);
    __pyx_v_bin = __pyx_t_5;
    __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF2f' onclick='toggleDiv("line98")'> 98:         outy[i] = np.trapz(fully[bin], fullx[bin])/dx[i]</pre>
<pre id='line98' class='code' style='background-color: #FFFF2f'>
    /* "unicorn/utils_c/interp_c.pyx":98
 *     for i in range(len(x)):
 *         bin = (fullx >= midpoint[i]) & (fullx <code><</code>= midpoint[i+1])
 *         outy[i] = np.trapz(fully[bin], fullx[bin])/dx[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return outy
 */
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_1 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_5, __pyx_n_s__trapz);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_fully), __pyx_v_bin);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetItem</span>(((PyObject *)__pyx_v_fullx), __pyx_v_bin);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_4);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
    __pyx_t_5 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_1, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(((PyObject *)__pyx_v_dx), __pyx_v_i, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    if (<span class='pyx_c_api'>__Pyx_SetItemInt</span>(((PyObject *)__pyx_v_outy), __pyx_v_i, __pyx_t_1, sizeof(long), PyInt_FromLong) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: </pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line100")'> 100:     return outy</pre>
<pre id='line100' class='code' style='background-color: #FFFF57'>
  /* "unicorn/utils_c/interp_c.pyx":100
 *         outy[i] = np.trapz(fully[bin], fullx[bin])/dx[i]
 * 
 *     return outy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.boundscheck(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_outy));
  __pyx_r = ((PyObject *)__pyx_v_outy);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_conserve", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_fullx);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_fully);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_so);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_outy);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_dx);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_midpoint);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_int_midpoint);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_bin);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: @cython.boundscheck(False)</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF18' onclick='toggleDiv("line103")'> 103: def interp_conserve_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] tlam, np.ndarray[DTYPE_t, ndim=1] tf, double left=0, double right=0):</pre>
<pre id='line103' class='code' style='background-color: #FFFF18'>
/* "unicorn/utils_c/interp_c.pyx":103
 * 
 * @cython.boundscheck(False)
 * def interp_conserve_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] tlam, np.ndarray[DTYPE_t, ndim=1] tf, double left=0, double right=0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     interp_conserve_c(x, xp, fp, left=0, right=0)
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_2interp_conserve_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7unicorn_7utils_c_8interp_c_2interp_conserve_c[] = "\n    interp_conserve_c(x, xp, fp, left=0, right=0)\n    \n    Interpolate `xp`,`yp` array to the output x array, conserving flux.  \n    `xp` can be irregularly spaced.\n    ";
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_2interp_conserve_c = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("interp_conserve_c"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_2interp_conserve_c, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_7unicorn_7utils_c_8interp_c_2interp_conserve_c)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_2interp_conserve_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  PyArrayObject *__pyx_v_tlam = 0;
  PyArrayObject *__pyx_v_tf = 0;
  double __pyx_v_left;
  double __pyx_v_right;
  PyArrayObject *__pyx_v_templmid = 0;
  PyArrayObject *__pyx_v_tempfmid = 0;
  PyArrayObject *__pyx_v_outy = 0;
  unsigned long __pyx_v_i;
  unsigned long __pyx_v_k;
  unsigned long __pyx_v_istart;
  unsigned long __pyx_v_ntlam;
  unsigned long __pyx_v_NTEMPL;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_h;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_numsum;
  Py_buffer __pyx_bstruct_tempfmid;
  Py_ssize_t __pyx_bstride_0_tempfmid = 0;
  Py_ssize_t __pyx_bshape_0_tempfmid = 0;
  Py_buffer __pyx_bstruct_outy;
  Py_ssize_t __pyx_bstride_0_outy = 0;
  Py_ssize_t __pyx_bshape_0_outy = 0;
  Py_buffer __pyx_bstruct_tf;
  Py_ssize_t __pyx_bstride_0_tf = 0;
  Py_ssize_t __pyx_bshape_0_tf = 0;
  Py_buffer __pyx_bstruct_x;
  Py_ssize_t __pyx_bstride_0_x = 0;
  Py_ssize_t __pyx_bshape_0_x = 0;
  Py_buffer __pyx_bstruct_tlam;
  Py_ssize_t __pyx_bstride_0_tlam = 0;
  Py_ssize_t __pyx_bshape_0_tlam = 0;
  Py_buffer __pyx_bstruct_templmid;
  Py_ssize_t __pyx_bstride_0_templmid = 0;
  Py_ssize_t __pyx_bshape_0_templmid = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__x,&__pyx_n_s__tlam,&__pyx_n_s__tf,&__pyx_n_s__left,&__pyx_n_s__right,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("interp_conserve_c");
  __pyx_self = __pyx_self;
  {
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__x);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__tlam);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve_c", 0, 3, 5, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__tf);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve_c", 0, 3, 5, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__left);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__right);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "interp_conserve_c") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_tlam = ((PyArrayObject *)values[1]);
    __pyx_v_tf = ((PyArrayObject *)values[2]);
    if (values[3]) {
      __pyx_v_left = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_left == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_left = ((double)0.0);
    }
    if (values[4]) {
      __pyx_v_right = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_right == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_right = ((double)0.0);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("interp_conserve_c", 0, 3, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_conserve_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_templmid.buf = NULL;
  __pyx_bstruct_tempfmid.buf = NULL;
  __pyx_bstruct_outy.buf = NULL;
  __pyx_bstruct_x.buf = NULL;
  __pyx_bstruct_tlam.buf = NULL;
  __pyx_bstruct_tf.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_tlam), __pyx_ptype_5numpy_ndarray, 1, "tlam", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_tf), __pyx_ptype_5numpy_ndarray, 1, "tf", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_x, (PyObject*)__pyx_v_x, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_x = __pyx_bstruct_x.strides[0];
  __pyx_bshape_0_x = __pyx_bstruct_x.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_tlam, (PyObject*)__pyx_v_tlam, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_tlam = __pyx_bstruct_tlam.strides[0];
  __pyx_bshape_0_tlam = __pyx_bstruct_tlam.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_tf, (PyObject*)__pyx_v_tf, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_tf = __pyx_bstruct_tf.strides[0];
  __pyx_bshape_0_tf = __pyx_bstruct_tf.shape[0];

  /* "unicorn/utils_c/interp_c.pyx":103
 * 
 * @cython.boundscheck(False)
 * def interp_conserve_c(np.ndarray[DTYPE_t, ndim=1] x, np.ndarray[DTYPE_t, ndim=1] tlam, np.ndarray[DTYPE_t, ndim=1] tf, double left=0, double right=0):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     interp_conserve_c(x, xp, fp, left=0, right=0)
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_2interp_conserve_c, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__interp_conserve_c, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     """</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     interp_conserve_c(x, xp, fp, left=0, right=0)</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106: </pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     Interpolate `xp`,`yp` array to the output x array, conserving flux.</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108:     `xp` can be irregularly spaced.</pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:     """</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110:     cdef np.ndarray[DTYPE_t, ndim=1] templmid</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line111")'> 111:     cdef np.ndarray[DTYPE_t, ndim=1] tempfmid</pre>
<pre id='line111' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112:     cdef np.ndarray[DTYPE_t, ndim=1] outy</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113:     cdef unsigned long i,k,istart,ntlam,NTEMPL</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114:     cdef DTYPE_t h, numsum</pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115: </pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116:     # templmid = (x[1:]+x[:-1])/2. #2.+x[:-1]</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117:     # templmid = np.append(templmid, np.array([x[0], x[-1]]))</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:     # templmid = templmid[np.argsort(templmid)]</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line119")'> 119:     NTEMPL = len(x)</pre>
<pre id='line119' class='code' style='background-color: #FFFFaa'>
  /* "unicorn/utils_c/interp_c.pyx":119
 *     # templmid = np.append(templmid, np.array([x[0], x[-1]]))
 *     # templmid = templmid[np.argsort(templmid)]
 *     NTEMPL = len(x)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     ntlam = len(tlam)
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_x));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_NTEMPL = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line120")'> 120:     ntlam = len(tlam)</pre>
<pre id='line120' class='code' style='background-color: #FFFFaa'>
  /* "unicorn/utils_c/interp_c.pyx":120
 *     # templmid = templmid[np.argsort(templmid)]
 *     NTEMPL = len(x)
 *     ntlam = len(tlam)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     templmid = midpoint_c(x, NTEMPL)
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_tlam));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_ntlam = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121: </pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line122")'> 122:     templmid = midpoint_c(x, NTEMPL)</pre>
<pre id='line122' class='code' style='background-color: #FFFF31'>
  /* "unicorn/utils_c/interp_c.pyx":122
 *     ntlam = len(tlam)
 * 
 *     templmid = midpoint_c(x, NTEMPL)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #tempfmid = np.interp(templmid, tlam, tf, left=left, right=right)
 *     tempfmid = interp_c(templmid, tlam, tf, extrapolate=0.)
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__midpoint_c);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMPL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_x));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_x));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_x));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templmid);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_templmid, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_templmid, (PyObject*)__pyx_v_templmid, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      }
    }
    __pyx_bstride_0_templmid = __pyx_bstruct_templmid.strides[0];
    __pyx_bshape_0_templmid = __pyx_bstruct_templmid.shape[0];
    if (unlikely(__pyx_t_6 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 122; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_5 = 0;
  __pyx_v_templmid = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:     #tempfmid = np.interp(templmid, tlam, tf, left=left, right=right)</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line124")'> 124:     tempfmid = interp_c(templmid, tlam, tf, extrapolate=0.)</pre>
<pre id='line124' class='code' style='background-color: #FFFF26'>
  /* "unicorn/utils_c/interp_c.pyx":124
 *     templmid = midpoint_c(x, NTEMPL)
 *     #tempfmid = np.interp(templmid, tlam, tf, left=left, right=right)
 *     tempfmid = interp_c(templmid, tlam, tf, extrapolate=0.)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     outy = np.zeros(NTEMPL, dtype=DTYPE)
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__interp_c);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_templmid));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_v_templmid));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_templmid));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_tlam));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, ((PyObject *)__pyx_v_tlam));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_tlam));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_tf));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, ((PyObject *)__pyx_v_tf));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_tf));
  __pyx_t_2 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(0.);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, ((PyObject *)__pyx_n_s__extrapolate), __pyx_t_10) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_2));<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_10) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_10, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_11 = ((PyArrayObject *)__pyx_t_10);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tempfmid);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_tempfmid, (PyObject*)__pyx_t_11, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_8, &__pyx_t_7);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_tempfmid, (PyObject*)__pyx_v_tempfmid, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_7);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_8, __pyx_t_7);
      }
    }
    __pyx_bstride_0_tempfmid = __pyx_bstruct_tempfmid.strides[0];
    __pyx_bshape_0_tempfmid = __pyx_bstruct_tempfmid.shape[0];
    if (unlikely(__pyx_t_6 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_11 = 0;
  __pyx_v_tempfmid = ((PyArrayObject *)__pyx_t_10);
  __pyx_t_10 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125: </pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line126")'> 126:     outy = np.zeros(NTEMPL, dtype=DTYPE)</pre>
<pre id='line126' class='code' style='background-color: #FFFF24'>
  /* "unicorn/utils_c/interp_c.pyx":126
 *     tempfmid = interp_c(templmid, tlam, tf, extrapolate=0.)
 * 
 *     outy = np.zeros(NTEMPL, dtype=DTYPE)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     ###### Rebin template grid to master wavelength grid, conserving template flux
 */
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_10, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMPL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_10);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_10);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_10));
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_10, ((PyObject *)__pyx_n_s__dtype), __pyx_t_3) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_10));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_10)); __pyx_t_10 = 0;
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_12 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_outy);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_outy, (PyObject*)__pyx_t_12, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_6 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_outy, (PyObject*)__pyx_v_outy, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_7); Py_XDECREF(__pyx_t_8); Py_XDECREF(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      }
    }
    __pyx_bstride_0_outy = __pyx_bstruct_outy.strides[0];
    __pyx_bshape_0_outy = __pyx_bstruct_outy.shape[0];
    if (unlikely(__pyx_t_6 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 126; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_12 = 0;
  __pyx_v_outy = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127: </pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128:     ###### Rebin template grid to master wavelength grid, conserving template flux</pre>
<pre id='line128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     i=0</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":129
 * 
 *     ###### Rebin template grid to master wavelength grid, conserving template flux
 *     i=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for k in range(NTEMPL):
 *         numsum=0.;
 */
  __pyx_v_i = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130:     for k in range(NTEMPL):</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":130
 *     ###### Rebin template grid to master wavelength grid, conserving template flux
 *     i=0
 *     for k in range(NTEMPL):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         numsum=0.;
 * 
 */
  __pyx_t_13 = __pyx_v_NTEMPL;
  for (__pyx_t_14 = 0; __pyx_t_14 <code><</code> __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_k = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131:         numsum=0.;</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":131
 *     i=0
 *     for k in range(NTEMPL):
 *         numsum=0.;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #### Go to where tlam is greater than the first midpoint
 */
    __pyx_v_numsum = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132: </pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:         #### Go to where tlam is greater than the first midpoint</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:         while (tlam[i] &lt; templmid[k]) &amp; (i &lt; ntlam): i+=1;</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":134
 * 
 *         #### Go to where tlam is greater than the first midpoint
 *         while (tlam[i] <code><</code> templmid[k]) & (i <code><</code> ntlam): i+=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         istart=i;
 * 
 */
    while (1) {
      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = __pyx_v_k;
      __pyx_t_17 = (((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_15, __pyx_bstride_0_tlam)) <code><</code> (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_16, __pyx_bstride_0_templmid))) & (__pyx_v_i <code><</code> __pyx_v_ntlam));
      if (!__pyx_t_17) break;
      __pyx_v_i = (__pyx_v_i + 1);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:         istart=i;</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":135
 *         #### Go to where tlam is greater than the first midpoint
 *         while (tlam[i] <code><</code> templmid[k]) & (i <code><</code> ntlam): i+=1;
 *         istart=i;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         ####### First point
 */
    __pyx_v_istart = __pyx_v_i;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136: </pre>
<pre id='line136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137:         ####### First point</pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138:         if tlam[i] &lt; templmid[k+1]:</pre>
<pre id='line138' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":138
 * 
 *         ####### First point
 *         if tlam[i] <code><</code> templmid[k+1]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             h = tlam[i]-templmid[k];
 *             numsum+=h*(tf[i]+tempfmid[k]);
 */
    __pyx_t_18 = __pyx_v_i;
    __pyx_t_19 = (__pyx_v_k + 1);
    __pyx_t_17 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_18, __pyx_bstride_0_tlam)) <code><</code> (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_19, __pyx_bstride_0_templmid)));
    if (__pyx_t_17) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139:             h = tlam[i]-templmid[k];</pre>
<pre id='line139' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":139
 *         ####### First point
 *         if tlam[i] <code><</code> templmid[k+1]:
 *             h = tlam[i]-templmid[k];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             numsum+=h*(tf[i]+tempfmid[k]);
 *             i+=1;
 */
      __pyx_t_20 = __pyx_v_i;
      __pyx_t_21 = __pyx_v_k;
      __pyx_v_h = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_20, __pyx_bstride_0_tlam)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_21, __pyx_bstride_0_templmid)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:             numsum+=h*(tf[i]+tempfmid[k]);</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":140
 *         if tlam[i] <code><</code> templmid[k+1]:
 *             h = tlam[i]-templmid[k];
 *             numsum+=h*(tf[i]+tempfmid[k]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             i+=1;
 * 
 */
      __pyx_t_22 = __pyx_v_i;
      __pyx_t_23 = __pyx_v_k;
      __pyx_v_numsum = (__pyx_v_numsum + (__pyx_v_h * ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_22, __pyx_bstride_0_tf)) + (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tempfmid.buf, __pyx_t_23, __pyx_bstride_0_tempfmid)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line141")'> 141:             i+=1;</pre>
<pre id='line141' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":141
 *             h = tlam[i]-templmid[k];
 *             numsum+=h*(tf[i]+tempfmid[k]);
 *             i+=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if i==0: i+=1;
 */
      __pyx_v_i = (__pyx_v_i + 1);
      goto __pyx_L10;
    }
    __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142: </pre>
<pre id='line142' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143:         if i==0: i+=1;</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":143
 *             i+=1;
 * 
 *         if i==0: i+=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         ####### Template points between master grid points
 */
    __pyx_t_17 = (__pyx_v_i == 0);
    if (__pyx_t_17) {
      __pyx_v_i = (__pyx_v_i + 1);
      goto __pyx_L11;
    }
    __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144: </pre>
<pre id='line144' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145:         ####### Template points between master grid points</pre>
<pre id='line145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146:         while (tlam[i] &lt; templmid[k+1]) &amp; (i &lt; ntlam):</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":146
 * 
 *         ####### Template points between master grid points
 *         while (tlam[i] <code><</code> templmid[k+1]) & (i <code><</code> ntlam):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             h = tlam[i]-tlam[i-1];
 *             numsum+=h*(tf[i]+tf[i-1]);
 */
    while (1) {
      __pyx_t_24 = __pyx_v_i;
      __pyx_t_25 = (__pyx_v_k + 1);
      __pyx_t_17 = (((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_24, __pyx_bstride_0_tlam)) <code><</code> (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_25, __pyx_bstride_0_templmid))) & (__pyx_v_i <code><</code> __pyx_v_ntlam));
      if (!__pyx_t_17) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:             h = tlam[i]-tlam[i-1];</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":147
 *         ####### Template points between master grid points
 *         while (tlam[i] <code><</code> templmid[k+1]) & (i <code><</code> ntlam):
 *             h = tlam[i]-tlam[i-1];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             numsum+=h*(tf[i]+tf[i-1]);
 *             i+=1;
 */
      __pyx_t_26 = __pyx_v_i;
      __pyx_t_27 = (__pyx_v_i - 1);
      __pyx_v_h = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_26, __pyx_bstride_0_tlam)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_27, __pyx_bstride_0_tlam)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:             numsum+=h*(tf[i]+tf[i-1]);</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":148
 *         while (tlam[i] <code><</code> templmid[k+1]) & (i <code><</code> ntlam):
 *             h = tlam[i]-tlam[i-1];
 *             numsum+=h*(tf[i]+tf[i-1]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             i+=1;
 * 
 */
      __pyx_t_28 = __pyx_v_i;
      __pyx_t_29 = (__pyx_v_i - 1);
      __pyx_v_numsum = (__pyx_v_numsum + (__pyx_v_h * ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_28, __pyx_bstride_0_tf)) + (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_29, __pyx_bstride_0_tf)))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line149")'> 149:             i+=1;</pre>
<pre id='line149' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":149
 *             h = tlam[i]-tlam[i-1];
 *             numsum+=h*(tf[i]+tf[i-1]);
 *             i+=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         #### If no template points between master grid points, then just use interpolated midpoints
 */
      __pyx_v_i = (__pyx_v_i + 1);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150: </pre>
<pre id='line150' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:         #### If no template points between master grid points, then just use interpolated midpoints</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line152")'> 152:         if i == istart:</pre>
<pre id='line152' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":152
 * 
 *         #### If no template points between master grid points, then just use interpolated midpoints
 *         if i == istart:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             h = templmid[k+1]-templmid[k];
 *             numsum=h*(tempfmid[k+1]+tempfmid[k]);
 */
    __pyx_t_17 = (__pyx_v_i == __pyx_v_istart);
    if (__pyx_t_17) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153:             h = templmid[k+1]-templmid[k];</pre>
<pre id='line153' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":153
 *         #### If no template points between master grid points, then just use interpolated midpoints
 *         if i == istart:
 *             h = templmid[k+1]-templmid[k];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             numsum=h*(tempfmid[k+1]+tempfmid[k]);
 *         else:
 */
      __pyx_t_30 = (__pyx_v_k + 1);
      __pyx_t_31 = __pyx_v_k;
      __pyx_v_h = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_30, __pyx_bstride_0_templmid)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_31, __pyx_bstride_0_templmid)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154:             numsum=h*(tempfmid[k+1]+tempfmid[k]);</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":154
 *         if i == istart:
 *             h = templmid[k+1]-templmid[k];
 *             numsum=h*(tempfmid[k+1]+tempfmid[k]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             ##### Last point
 */
      __pyx_t_32 = (__pyx_v_k + 1);
      __pyx_t_33 = __pyx_v_k;
      __pyx_v_numsum = (__pyx_v_h * ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tempfmid.buf, __pyx_t_32, __pyx_bstride_0_tempfmid)) + (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tempfmid.buf, __pyx_t_33, __pyx_bstride_0_tempfmid))));
      goto __pyx_L14;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155:         else:</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line156")'> 156:             ##### Last point</pre>
<pre id='line156' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:             if (templmid[k+1] == tlam[i]) &amp; (i &lt; ntlam):</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":157
 *         else:
 *             ##### Last point
 *             if (templmid[k+1] == tlam[i]) & (i <code><</code> ntlam):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 h = tlam[i]-tlam[i-1];
 *                 numsum+=h*(tf[i]+tf[i-1]);
 */
      __pyx_t_34 = (__pyx_v_k + 1);
      __pyx_t_35 = __pyx_v_i;
      __pyx_t_17 = (((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_34, __pyx_bstride_0_templmid)) == (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_35, __pyx_bstride_0_tlam))) & (__pyx_v_i <code><</code> __pyx_v_ntlam));
      if (__pyx_t_17) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:                 h = tlam[i]-tlam[i-1];</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":158
 *             ##### Last point
 *             if (templmid[k+1] == tlam[i]) & (i <code><</code> ntlam):
 *                 h = tlam[i]-tlam[i-1];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 numsum+=h*(tf[i]+tf[i-1]);
 *             else:
 */
        __pyx_t_36 = __pyx_v_i;
        __pyx_t_37 = (__pyx_v_i - 1);
        __pyx_v_h = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_36, __pyx_bstride_0_tlam)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_37, __pyx_bstride_0_tlam)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159:                 numsum+=h*(tf[i]+tf[i-1]);</pre>
<pre id='line159' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":159
 *             if (templmid[k+1] == tlam[i]) & (i <code><</code> ntlam):
 *                 h = tlam[i]-tlam[i-1];
 *                 numsum+=h*(tf[i]+tf[i-1]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 i-=1;
 */
        __pyx_t_38 = __pyx_v_i;
        __pyx_t_39 = (__pyx_v_i - 1);
        __pyx_v_numsum = (__pyx_v_numsum + (__pyx_v_h * ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_38, __pyx_bstride_0_tf)) + (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_39, __pyx_bstride_0_tf)))));
        goto __pyx_L15;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:             else:</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:                 i-=1;</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":161
 *                 numsum+=h*(tf[i]+tf[i-1]);
 *             else:
 *                 i-=1;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 h = templmid[k+1]-tlam[i];
 *                 numsum+=h*(tempfmid[k+1]+tf[i]);
 */
        __pyx_v_i = (__pyx_v_i - 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:                 h = templmid[k+1]-tlam[i];</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":162
 *             else:
 *                 i-=1;
 *                 h = templmid[k+1]-tlam[i];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 numsum+=h*(tempfmid[k+1]+tf[i]);
 * 
 */
        __pyx_t_40 = (__pyx_v_k + 1);
        __pyx_t_41 = __pyx_v_i;
        __pyx_v_h = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_40, __pyx_bstride_0_templmid)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tlam.buf, __pyx_t_41, __pyx_bstride_0_tlam)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:                 numsum+=h*(tempfmid[k+1]+tf[i]);</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'>
        /* "unicorn/utils_c/interp_c.pyx":163
 *                 i-=1;
 *                 h = templmid[k+1]-tlam[i];
 *                 numsum+=h*(tempfmid[k+1]+tf[i]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         outy[k] = numsum*0.5/(templmid[k+1]-templmid[k]);
 */
        __pyx_t_42 = (__pyx_v_k + 1);
        __pyx_t_43 = __pyx_v_i;
        __pyx_v_numsum = (__pyx_v_numsum + (__pyx_v_h * ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tempfmid.buf, __pyx_t_42, __pyx_bstride_0_tempfmid)) + (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_tf.buf, __pyx_t_43, __pyx_bstride_0_tf)))));
      }
      __pyx_L15:;
    }
    __pyx_L14:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164: </pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line165")'> 165:         outy[k] = numsum*0.5/(templmid[k+1]-templmid[k]);</pre>
<pre id='line165' class='code' style='background-color: #FFFFaa'>
    /* "unicorn/utils_c/interp_c.pyx":165
 *                 numsum+=h*(tempfmid[k+1]+tf[i]);
 * 
 *         outy[k] = numsum*0.5/(templmid[k+1]-templmid[k]);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return outy
 */
    __pyx_t_44 = (__pyx_v_numsum * 0.5);
    __pyx_t_45 = (__pyx_v_k + 1);
    __pyx_t_46 = __pyx_v_k;
    __pyx_t_47 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_45, __pyx_bstride_0_templmid)) - (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templmid.buf, __pyx_t_46, __pyx_bstride_0_templmid)));
    if (unlikely(__pyx_t_47 == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 165; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_48 = __pyx_v_k;
    *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_outy.buf, __pyx_t_48, __pyx_bstride_0_outy) = (__pyx_t_44 / __pyx_t_47);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166: </pre>
<pre id='line166' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line167")'> 167:     return outy</pre>
<pre id='line167' class='code' style='background-color: #FFFF32'>
  /* "unicorn/utils_c/interp_c.pyx":167
 *         outy[k] = numsum*0.5/(templmid[k+1]-templmid[k]);
 * 
 *     return outy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def midpoint(x):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_outy));
  __pyx_r = ((PyObject *)__pyx_v_outy);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tempfmid);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_outy);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tf);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tlam);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templmid);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.interp_conserve_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tempfmid);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_outy);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tf);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_tlam);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templmid);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_templmid);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_tempfmid);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_outy);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168: </pre>
<pre id='line168' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line169")'> 169: def midpoint(x):</pre>
<pre id='line169' class='code' style='background-color: #FFFF8d'>
/* "unicorn/utils_c/interp_c.pyx":169
 *     return outy
 * 
 * def midpoint(x):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     mp = (x[1:]+x[:-1])/2.
 *     mp = np.append(mp, np.array([x[0],x[-1]]))
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_3midpoint(PyObject *__pyx_self, PyObject *__pyx_v_x); /*proto*/
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_3midpoint = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("midpoint"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_3midpoint, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_3midpoint(PyObject *__pyx_self, PyObject *__pyx_v_x) {
  PyObject *__pyx_v_mp = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("midpoint");
  __pyx_self = __pyx_self;

  /* "unicorn/utils_c/interp_c.pyx":169
 *     return outy
 * 
 * def midpoint(x):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     mp = (x[1:]+x[:-1])/2.
 *     mp = np.append(mp, np.array([x[0],x[-1]]))
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_3midpoint, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__midpoint, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line170")'> 170:     mp = (x[1:]+x[:-1])/2.</pre>
<pre id='line170' class='code' style='background-color: #FFFF41'>
  /* "unicorn/utils_c/interp_c.pyx":170
 * 
 * def midpoint(x):
 *     mp = (x[1:]+x[:-1])/2.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     mp = np.append(mp, np.array([x[0],x[-1]]))
 *     mp = mp[np.argsort(mp)]
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_x, 1, PY_SSIZE_T_MAX);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PySequence_GetSlice</span>(__pyx_v_x, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(2.);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyNumber_Divide</span>(__pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_mp = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF26' onclick='toggleDiv("line171")'> 171:     mp = np.append(mp, np.array([x[0],x[-1]]))</pre>
<pre id='line171' class='code' style='background-color: #FFFF26'>
  /* "unicorn/utils_c/interp_c.pyx":171
 * def midpoint(x):
 *     mp = (x[1:]+x[:-1])/2.
 *     mp = np.append(mp, np.array([x[0],x[-1]]))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     mp = mp[np.argsort(mp)]
 *     return mp
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__append);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_v_x, -1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_5));
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_mp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_mp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 171; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_mp);
  __pyx_v_mp = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line172")'> 172:     mp = mp[np.argsort(mp)]</pre>
<pre id='line172' class='code' style='background-color: #FFFF41'>
  /* "unicorn/utils_c/interp_c.pyx":172
 *     mp = (x[1:]+x[:-1])/2.
 *     mp = np.append(mp, np.array([x[0],x[-1]]))
 *     mp = mp[np.argsort(mp)]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return mp
 * 
 */
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_5, __pyx_n_s__argsort);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mp);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_v_mp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_mp);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_v_mp, __pyx_t_2);<span class='error_goto'> if (!__pyx_t_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 172; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_mp);
  __pyx_v_mp = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line173")'> 173:     return mp</pre>
<pre id='line173' class='code' style='background-color: #FFFF73'>
  /* "unicorn/utils_c/interp_c.pyx":173
 *     mp = np.append(mp, np.array([x[0],x[-1]]))
 *     mp = mp[np.argsort(mp)]
 *     return mp             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * def midpoint_c(np.ndarray[DTYPE_t, ndim=1] x, long N):
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mp);
  __pyx_r = __pyx_v_mp;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.midpoint", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mp);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: </pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF27' onclick='toggleDiv("line175")'> 175: def midpoint_c(np.ndarray[DTYPE_t, ndim=1] x, long N):</pre>
<pre id='line175' class='code' style='background-color: #FFFF27'>
/* "unicorn/utils_c/interp_c.pyx":175
 *     return mp
 * 
 * def midpoint_c(np.ndarray[DTYPE_t, ndim=1] x, long N):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long i
 *     cdef DTYPE_t xi,xi1
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_4midpoint_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_4midpoint_c = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("midpoint_c"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_4midpoint_c, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_4midpoint_c(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_x = 0;
  long __pyx_v_N;
  long __pyx_v_i;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_xi;
  __pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t __pyx_v_xi1;
  PyArrayObject *__pyx_v_midpoint = 0;
  Py_buffer __pyx_bstruct_midpoint;
  Py_ssize_t __pyx_bstride_0_midpoint = 0;
  Py_ssize_t __pyx_bshape_0_midpoint = 0;
  Py_buffer __pyx_bstruct_x;
  Py_ssize_t __pyx_bstride_0_x = 0;
  Py_ssize_t __pyx_bshape_0_x = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__x,&__pyx_n_s__N,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("midpoint_c");
  __pyx_self = __pyx_self;
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__x);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__N);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("midpoint_c", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "midpoint_c") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_x = ((PyArrayObject *)values[0]);
    __pyx_v_N = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_N == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("midpoint_c", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.midpoint_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_midpoint.buf = NULL;
  __pyx_bstruct_x.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_x), __pyx_ptype_5numpy_ndarray, 1, "x", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_x, (PyObject*)__pyx_v_x, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_x = __pyx_bstruct_x.strides[0];
  __pyx_bshape_0_x = __pyx_bstruct_x.shape[0];

  /* "unicorn/utils_c/interp_c.pyx":175
 *     return mp
 * 
 * def midpoint_c(np.ndarray[DTYPE_t, ndim=1] x, long N):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef long i
 *     cdef DTYPE_t xi,xi1
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_4midpoint_c, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__midpoint_c, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:     cdef long i</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:     cdef DTYPE_t xi,xi1</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:     # N = len(x)</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line179")'> 179:     cdef np.ndarray[DTYPE_t, ndim=1] midpoint = np.zeros(N+1, dtype=DTYPE)</pre>
<pre id='line179' class='code' style='background-color: #FFFF2e'>
  /* "unicorn/utils_c/interp_c.pyx":179
 *     cdef DTYPE_t xi,xi1
 *     # N = len(x)
 *     cdef np.ndarray[DTYPE_t, ndim=1] midpoint = np.zeros(N+1, dtype=DTYPE)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     midpoint[0] = x[0]
 *     midpoint[N] = x[N-1]
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_N + 1));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, ((PyObject *)__pyx_n_s__dtype), __pyx_t_4) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), ((PyObject *)__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_midpoint, (PyObject*)__pyx_t_5, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_midpoint = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_bstruct_midpoint.buf = NULL;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 179; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_bstride_0_midpoint = __pyx_bstruct_midpoint.strides[0];
      __pyx_bshape_0_midpoint = __pyx_bstruct_midpoint.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_midpoint = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line180")'> 180:     midpoint[0] = x[0]</pre>
<pre id='line180' class='code' style='background-color: #FFFFb6'>
  /* "unicorn/utils_c/interp_c.pyx":180
 *     # N = len(x)
 *     cdef np.ndarray[DTYPE_t, ndim=1] midpoint = np.zeros(N+1, dtype=DTYPE)
 *     midpoint[0] = x[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     midpoint[N] = x[N-1]
 *     xi1 = x[0]
 */
  __pyx_t_6 = 0;
  __pyx_t_7 = -1;
  if (__pyx_t_6 <code><</code> 0) {
    __pyx_t_6 += __pyx_bshape_0_x;
    if (unlikely(__pyx_t_6 <code><</code> 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_6 >= __pyx_bshape_0_x)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = 0;
  __pyx_t_7 = -1;
  if (__pyx_t_8 <code><</code> 0) {
    __pyx_t_8 += __pyx_bshape_0_midpoint;
    if (unlikely(__pyx_t_8 <code><</code> 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_8 >= __pyx_bshape_0_midpoint)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 180; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_midpoint.buf, __pyx_t_8, __pyx_bstride_0_midpoint) = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_6, __pyx_bstride_0_x));
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line181")'> 181:     midpoint[N] = x[N-1]</pre>
<pre id='line181' class='code' style='background-color: #FFFFb6'>
  /* "unicorn/utils_c/interp_c.pyx":181
 *     cdef np.ndarray[DTYPE_t, ndim=1] midpoint = np.zeros(N+1, dtype=DTYPE)
 *     midpoint[0] = x[0]
 *     midpoint[N] = x[N-1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     xi1 = x[0]
 *     for i in range(1, N):
 */
  __pyx_t_9 = (__pyx_v_N - 1);
  __pyx_t_7 = -1;
  if (__pyx_t_9 <code><</code> 0) {
    __pyx_t_9 += __pyx_bshape_0_x;
    if (unlikely(__pyx_t_9 <code><</code> 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_9 >= __pyx_bshape_0_x)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_10 = __pyx_v_N;
  __pyx_t_7 = -1;
  if (__pyx_t_10 <code><</code> 0) {
    __pyx_t_10 += __pyx_bshape_0_midpoint;
    if (unlikely(__pyx_t_10 <code><</code> 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_10 >= __pyx_bshape_0_midpoint)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 181; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_midpoint.buf, __pyx_t_10, __pyx_bstride_0_midpoint) = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_9, __pyx_bstride_0_x));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line182")'> 182:     xi1 = x[0]</pre>
<pre id='line182' class='code' style='background-color: #FFFFd4'>
  /* "unicorn/utils_c/interp_c.pyx":182
 *     midpoint[0] = x[0]
 *     midpoint[N] = x[N-1]
 *     xi1 = x[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i in range(1, N):
 *         xi = x[i]
 */
  __pyx_t_11 = 0;
  __pyx_t_7 = -1;
  if (__pyx_t_11 <code><</code> 0) {
    __pyx_t_11 += __pyx_bshape_0_x;
    if (unlikely(__pyx_t_11 <code><</code> 0)) __pyx_t_7 = 0;
  } else if (unlikely(__pyx_t_11 >= __pyx_bshape_0_x)) __pyx_t_7 = 0;
  if (unlikely(__pyx_t_7 != -1)) {
    <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 182; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_v_xi1 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_11, __pyx_bstride_0_x));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:     for i in range(1, N):</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":183
 *     midpoint[N] = x[N-1]
 *     xi1 = x[0]
 *     for i in range(1, N):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         xi = x[i]
 *         midpoint[i] = 0.5*xi+0.5*xi1
 */
  __pyx_t_12 = __pyx_v_N;
  for (__pyx_t_13 = 1; __pyx_t_13 <code><</code> __pyx_t_12; __pyx_t_13+=1) {
    __pyx_v_i = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line184")'> 184:         xi = x[i]</pre>
<pre id='line184' class='code' style='background-color: #FFFFd4'>
    /* "unicorn/utils_c/interp_c.pyx":184
 *     xi1 = x[0]
 *     for i in range(1, N):
 *         xi = x[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         midpoint[i] = 0.5*xi+0.5*xi1
 *         xi1 = xi
 */
    __pyx_t_14 = __pyx_v_i;
    __pyx_t_7 = -1;
    if (__pyx_t_14 <code><</code> 0) {
      __pyx_t_14 += __pyx_bshape_0_x;
      if (unlikely(__pyx_t_14 <code><</code> 0)) __pyx_t_7 = 0;
    } else if (unlikely(__pyx_t_14 >= __pyx_bshape_0_x)) __pyx_t_7 = 0;
    if (unlikely(__pyx_t_7 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 184; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_xi = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_x.buf, __pyx_t_14, __pyx_bstride_0_x));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line185")'> 185:         midpoint[i] = 0.5*xi+0.5*xi1</pre>
<pre id='line185' class='code' style='background-color: #FFFFd4'>
    /* "unicorn/utils_c/interp_c.pyx":185
 *     for i in range(1, N):
 *         xi = x[i]
 *         midpoint[i] = 0.5*xi+0.5*xi1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         xi1 = xi
 * 
 */
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_7 = -1;
    if (__pyx_t_15 <code><</code> 0) {
      __pyx_t_15 += __pyx_bshape_0_midpoint;
      if (unlikely(__pyx_t_15 <code><</code> 0)) __pyx_t_7 = 0;
    } else if (unlikely(__pyx_t_15 >= __pyx_bshape_0_midpoint)) __pyx_t_7 = 0;
    if (unlikely(__pyx_t_7 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_7);
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 185; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_midpoint.buf, __pyx_t_15, __pyx_bstride_0_midpoint) = ((0.5 * __pyx_v_xi) + (0.5 * __pyx_v_xi1));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:         xi1 = xi</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":186
 *         xi = x[i]
 *         midpoint[i] = 0.5*xi+0.5*xi1
 *         xi1 = xi             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return midpoint
 */
    __pyx_v_xi1 = __pyx_v_xi;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line188")'> 188:     return midpoint</pre>
<pre id='line188' class='code' style='background-color: #FFFF4d'>
  /* "unicorn/utils_c/interp_c.pyx":188
 *         xi1 = xi
 * 
 *     return midpoint             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.boundscheck(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_midpoint));
  __pyx_r = ((PyObject *)__pyx_v_midpoint);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_midpoint);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.midpoint_c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_midpoint);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_x);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_midpoint);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190: @cython.boundscheck(False)</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line191")'> 191: def prepare_nmf_amatrix(np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates):</pre>
<pre id='line191' class='code' style='background-color: #FFFF2b'>
/* "unicorn/utils_c/interp_c.pyx":191
 * 
 * @cython.boundscheck(False)
 * def prepare_nmf_amatrix(np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     prepare_nmf_amatrix(variance, templates)
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix[] = "\n    prepare_nmf_amatrix(variance, templates)\n    \n    Generate the \"A\" matrix needed for the NMF fit, which is essentially \n    T.transpose() dot T.  This function is separated from the main fitting routine \n    because it does not depend on the actual measured \"flux\", which the user\n    might want to vary independent of the variance\n    \n    `templates` (T) is a 2D matrix of size (NTEMPLATE, NBAND) in terms of photo-z\n    fitting ofphotometric bands.\n    \n    `variance` is an array with size (NBAND) representing the *measured* variance in \n    each band.  \n    \n    --- Cythonified from eazy/getphotz.c (G. Brammer et al. 2008) ---\n    \n    ";
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("prepare_nmf_amatrix"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_variance = 0;
  PyArrayObject *__pyx_v_templates = 0;
  PyArrayObject *__pyx_v_amatrix = 0;
  unsigned int __pyx_v_i;
  unsigned int __pyx_v_j;
  unsigned int __pyx_v_k;
  unsigned int __pyx_v_NTEMP;
  unsigned int __pyx_v_NFILT;
  Py_buffer __pyx_bstruct_templates;
  Py_ssize_t __pyx_bstride_0_templates = 0;
  Py_ssize_t __pyx_bstride_1_templates = 0;
  Py_ssize_t __pyx_bshape_0_templates = 0;
  Py_ssize_t __pyx_bshape_1_templates = 0;
  Py_buffer __pyx_bstruct_amatrix;
  Py_ssize_t __pyx_bstride_0_amatrix = 0;
  Py_ssize_t __pyx_bstride_1_amatrix = 0;
  Py_ssize_t __pyx_bshape_0_amatrix = 0;
  Py_ssize_t __pyx_bshape_1_amatrix = 0;
  Py_buffer __pyx_bstruct_variance;
  Py_ssize_t __pyx_bstride_0_variance = 0;
  Py_ssize_t __pyx_bshape_0_variance = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__variance,&__pyx_n_s__templates,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("prepare_nmf_amatrix");
  __pyx_self = __pyx_self;
  {
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__variance);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__templates);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("prepare_nmf_amatrix", 1, 2, 2, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "prepare_nmf_amatrix") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_variance = ((PyArrayObject *)values[0]);
    __pyx_v_templates = ((PyArrayObject *)values[1]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("prepare_nmf_amatrix", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.prepare_nmf_amatrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_amatrix.buf = NULL;
  __pyx_bstruct_variance.buf = NULL;
  __pyx_bstruct_templates.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_variance), __pyx_ptype_5numpy_ndarray, 1, "variance", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_templates), __pyx_ptype_5numpy_ndarray, 1, "templates", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_variance, (PyObject*)__pyx_v_variance, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_variance = __pyx_bstruct_variance.strides[0];
  __pyx_bshape_0_variance = __pyx_bstruct_variance.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_templates, (PyObject*)__pyx_v_templates, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_templates = __pyx_bstruct_templates.strides[0]; __pyx_bstride_1_templates = __pyx_bstruct_templates.strides[1];
  __pyx_bshape_0_templates = __pyx_bstruct_templates.shape[0]; __pyx_bshape_1_templates = __pyx_bstruct_templates.shape[1];

  /* "unicorn/utils_c/interp_c.pyx":191
 * 
 * @cython.boundscheck(False)
 * def prepare_nmf_amatrix(np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     prepare_nmf_amatrix(variance, templates)
 */
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_5prepare_nmf_amatrix, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__prepare_nmf_amatrix, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 191; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:     """</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:     prepare_nmf_amatrix(variance, templates)</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194: </pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:     Generate the "A" matrix needed for the NMF fit, which is essentially</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:     T.transpose() dot T.  This function is separated from the main fitting routine</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:     because it does not depend on the actual measured "flux", which the user</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:     might want to vary independent of the variance</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199: </pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:     `templates` (T) is a 2D matrix of size (NTEMPLATE, NBAND) in terms of photo-z</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:     fitting ofphotometric bands.</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202: </pre>
<pre id='line202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:     `variance` is an array with size (NBAND) representing the *measured* variance in</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:     each band.</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205: </pre>
<pre id='line205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:     --- Cythonified from eazy/getphotz.c (G. Brammer et al. 2008) ---</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207: </pre>
<pre id='line207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:     """</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209: </pre>
<pre id='line209' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210:     cdef np.ndarray[DTYPE_t, ndim=2] amatrix</pre>
<pre id='line210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211:     cdef unsigned int i,j,k,NTEMP,NFILT</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212: </pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF14' onclick='toggleDiv("line213")'> 213:     NTEMP, NFILT = np.shape(templates)</pre>
<pre id='line213' class='code' style='background-color: #FFFF14'>
  /* "unicorn/utils_c/interp_c.pyx":213
 *     cdef unsigned int i,j,k,NTEMP,NFILT
 * 
 *     NTEMP, NFILT = np.shape(templates)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     amatrix = np.zeros((NTEMP,NTEMP))
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_templates));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_templates));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_templates));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
    PyObject* sequence = __pyx_t_3;
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence) != 2)) {
        if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence) > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence));
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      if (unlikely(<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence) != 2)) {
        if (<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence) > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence));
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_1)) goto __pyx_L6_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L6_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_5(__pyx_t_4), 2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L7_unpacking_done;
    __pyx_L6_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (<span class='py_c_api'>PyErr_Occurred</span>() && <span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration)) <span class='py_c_api'>PyErr_Clear</span>();
    if (!<span class='py_c_api'>PyErr_Occurred</span>()) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_L7_unpacking_done:;
  }
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsUnsignedInt</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (unsigned int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = __Pyx_<span class='py_c_api'>PyInt_AsUnsignedInt</span>(__pyx_t_2);<span class='error_goto'> if (unlikely((__pyx_t_7 == (unsigned int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_NTEMP = __pyx_t_6;
  __pyx_v_NFILT = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line214")'> 214:     amatrix = np.zeros((NTEMP,NTEMP))</pre>
<pre id='line214' class='code' style='background-color: #FFFF25'>
  /* "unicorn/utils_c/interp_c.pyx":214
 * 
 *     NTEMP, NFILT = np.shape(templates)
 *     amatrix = np.zeros((NTEMP,NTEMP))             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     for i in range(NTEMP):
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMP);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMP);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_3 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_amatrix);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_amatrix, (PyObject*)__pyx_t_8, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_9 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_10, &__pyx_t_11, &__pyx_t_12);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_amatrix, (PyObject*)__pyx_v_amatrix, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_12);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_10, __pyx_t_11, __pyx_t_12);
      }
    }
    __pyx_bstride_0_amatrix = __pyx_bstruct_amatrix.strides[0]; __pyx_bstride_1_amatrix = __pyx_bstruct_amatrix.strides[1];
    __pyx_bshape_0_amatrix = __pyx_bstruct_amatrix.shape[0]; __pyx_bshape_1_amatrix = __pyx_bstruct_amatrix.shape[1];
    if (unlikely(__pyx_t_9 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 214; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_8 = 0;
  __pyx_v_amatrix = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215: </pre>
<pre id='line215' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216:     for i in range(NTEMP):</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":216
 *     amatrix = np.zeros((NTEMP,NTEMP))
 * 
 *     for i in range(NTEMP):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(NTEMP):
 *             amatrix[i,j] = 0.
 */
  __pyx_t_7 = __pyx_v_NTEMP;
  for (__pyx_t_6 = 0; __pyx_t_6 <code><</code> __pyx_t_7; __pyx_t_6+=1) {
    __pyx_v_i = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:         for j in range(NTEMP):</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":217
 * 
 *     for i in range(NTEMP):
 *         for j in range(NTEMP):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             amatrix[i,j] = 0.
 *             for k in range(NFILT):
 */
    __pyx_t_13 = __pyx_v_NTEMP;
    for (__pyx_t_14 = 0; __pyx_t_14 <code><</code> __pyx_t_13; __pyx_t_14+=1) {
      __pyx_v_j = __pyx_t_14;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:             amatrix[i,j] = 0.</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":218
 *     for i in range(NTEMP):
 *         for j in range(NTEMP):
 *             amatrix[i,j] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for k in range(NFILT):
 *                 amatrix[i,j]+=templates[i,k]*templates[j,k]/variance[k]
 */
      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = __pyx_v_j;
      *__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_amatrix.buf, __pyx_t_15, __pyx_bstride_0_amatrix, __pyx_t_16, __pyx_bstride_1_amatrix) = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219:             for k in range(NFILT):</pre>
<pre id='line219' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":219
 *         for j in range(NTEMP):
 *             amatrix[i,j] = 0.
 *             for k in range(NFILT):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 amatrix[i,j]+=templates[i,k]*templates[j,k]/variance[k]
 * 
 */
      __pyx_t_17 = __pyx_v_NFILT;
      for (__pyx_t_18 = 0; __pyx_t_18 <code><</code> __pyx_t_17; __pyx_t_18+=1) {
        __pyx_v_k = __pyx_t_18;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line220")'> 220:                 amatrix[i,j]+=templates[i,k]*templates[j,k]/variance[k]</pre>
<pre id='line220' class='code' style='background-color: #FFFFaa'>
        /* "unicorn/utils_c/interp_c.pyx":220
 *             amatrix[i,j] = 0.
 *             for k in range(NFILT):
 *                 amatrix[i,j]+=templates[i,k]*templates[j,k]/variance[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return amatrix
 */
        __pyx_t_19 = __pyx_v_i;
        __pyx_t_20 = __pyx_v_k;
        __pyx_t_21 = __pyx_v_j;
        __pyx_t_22 = __pyx_v_k;
        __pyx_t_23 = ((*__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templates.buf, __pyx_t_19, __pyx_bstride_0_templates, __pyx_t_20, __pyx_bstride_1_templates)) * (*__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templates.buf, __pyx_t_21, __pyx_bstride_0_templates, __pyx_t_22, __pyx_bstride_1_templates)));
        __pyx_t_24 = __pyx_v_k;
        __pyx_t_25 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_variance.buf, __pyx_t_24, __pyx_bstride_0_variance));
        if (unlikely(__pyx_t_25 == 0)) {
          <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
         <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 220; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        }
        __pyx_t_26 = __pyx_v_i;
        __pyx_t_27 = __pyx_v_j;
        *__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_amatrix.buf, __pyx_t_26, __pyx_bstride_0_amatrix, __pyx_t_27, __pyx_bstride_1_amatrix) += (__pyx_t_23 / __pyx_t_25);
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: </pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF44' onclick='toggleDiv("line222")'> 222:     return amatrix</pre>
<pre id='line222' class='code' style='background-color: #FFFF44'>
  /* "unicorn/utils_c/interp_c.pyx":222
 *                 amatrix[i,j]+=templates[i,k]*templates[j,k]/variance[k]
 * 
 *     return amatrix             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * @cython.boundscheck(False)
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_amatrix));
  __pyx_r = ((PyObject *)__pyx_v_amatrix);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templates);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_amatrix);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_variance);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.prepare_nmf_amatrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templates);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_amatrix);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_variance);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_amatrix);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: </pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224: @cython.boundscheck(False)</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF13' onclick='toggleDiv("line225")'> 225: def run_nmf(np.ndarray[DTYPE_t, ndim=1] flux, np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates, np.ndarray[DTYPE_t, ndim=2] amatrix, double toler=1.e-4, long MAXITER=100000, verbose=False):</pre>
<pre id='line225' class='code' style='background-color: #FFFF13'>
/* "unicorn/utils_c/interp_c.pyx":225
 * 
 * @cython.boundscheck(False)
 * def run_nmf(np.ndarray[DTYPE_t, ndim=1] flux, np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates, np.ndarray[DTYPE_t, ndim=2] amatrix, double toler=1.e-4, long MAXITER=100000, verbose=False):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     run_nmf(flux, variance, templates, amatrix, toler=1.e-4, MAXITER=100000, verbose=False)
 */

static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_6run_nmf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_7unicorn_7utils_c_8interp_c_6run_nmf[] = "\n    run_nmf(flux, variance, templates, amatrix, toler=1.e-4, MAXITER=100000, verbose=False)\n    \n    Run the \"NMF\" fit to determine the non-negative coefficients of the `templates`\n    matrix that best-fit the observed `flux` and `variance` arrays.\n    \n    `amatrix` is generated with the `prepare_nmf_amatrix` function.\n    \n    e.g.\n    \n    >>> coeffs = run_nmf(flux, variance, templates, amatrix)\n    >>> flux_fit = np.dot(coeffs.reshape((1,-1)), templates).flatten()\n    >>> chi2 = np.sum((flux-flux_fit)**2/variance)\n    \n    --- Cythonified from eazy/getphotz.c (G. Brammer et al. 2008) ---\n    ";
static PyMethodDef __pyx_mdef_7unicorn_7utils_c_8interp_c_6run_nmf = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("run_nmf"), (PyCFunction)__pyx_pf_7unicorn_7utils_c_8interp_c_6run_nmf, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_7unicorn_7utils_c_8interp_c_6run_nmf)};
static PyObject *__pyx_pf_7unicorn_7utils_c_8interp_c_6run_nmf(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_flux = 0;
  PyArrayObject *__pyx_v_variance = 0;
  PyArrayObject *__pyx_v_templates = 0;
  PyArrayObject *__pyx_v_amatrix = 0;
  double __pyx_v_toler;
  long __pyx_v_MAXITER;
  PyObject *__pyx_v_verbose = 0;
  unsigned long __pyx_v_i;
  unsigned long __pyx_v_j;
  unsigned long __pyx_v_k;
  unsigned long __pyx_v_itcount;
  unsigned long __pyx_v_NTEMP;
  double __pyx_v_tolnum;
  double __pyx_v_toldenom;
  double __pyx_v_tol;
  double __pyx_v_vold;
  double __pyx_v_av;
  PyArrayObject *__pyx_v_bvector = 0;
  PyObject *__pyx_v_NFILT = NULL;
  PyArrayObject *__pyx_v_coeffs = 0;
  Py_buffer __pyx_bstruct_templates;
  Py_ssize_t __pyx_bstride_0_templates = 0;
  Py_ssize_t __pyx_bstride_1_templates = 0;
  Py_ssize_t __pyx_bshape_0_templates = 0;
  Py_ssize_t __pyx_bshape_1_templates = 0;
  Py_buffer __pyx_bstruct_coeffs;
  Py_ssize_t __pyx_bstride_0_coeffs = 0;
  Py_ssize_t __pyx_bshape_0_coeffs = 0;
  Py_buffer __pyx_bstruct_flux;
  Py_ssize_t __pyx_bstride_0_flux = 0;
  Py_ssize_t __pyx_bshape_0_flux = 0;
  Py_buffer __pyx_bstruct_amatrix;
  Py_ssize_t __pyx_bstride_0_amatrix = 0;
  Py_ssize_t __pyx_bstride_1_amatrix = 0;
  Py_ssize_t __pyx_bshape_0_amatrix = 0;
  Py_ssize_t __pyx_bshape_1_amatrix = 0;
  Py_buffer __pyx_bstruct_bvector;
  Py_ssize_t __pyx_bstride_0_bvector = 0;
  Py_ssize_t __pyx_bshape_0_bvector = 0;
  Py_buffer __pyx_bstruct_variance;
  Py_ssize_t __pyx_bstride_0_variance = 0;
  Py_ssize_t __pyx_bshape_0_variance = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__flux,&__pyx_n_s__variance,&__pyx_n_s__templates,&__pyx_n_s__amatrix,&__pyx_n_s__toler,&__pyx_n_s__MAXITER,&__pyx_n_s__verbose,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("run_nmf");
  __pyx_self = __pyx_self;
  {
    PyObject* values[7] = {0,0,0,0,0,0,0};
    values[6] = __pyx_k_3;
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__flux);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__variance);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("run_nmf", 0, 4, 7, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__templates);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("run_nmf", 0, 4, 7, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__amatrix);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("run_nmf", 0, 4, 7, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__toler);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__MAXITER);
          if (value) { values[5] = value; kw_args--; }
        }
        case  6:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__verbose);
          if (value) { values[6] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "run_nmf") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_flux = ((PyArrayObject *)values[0]);
    __pyx_v_variance = ((PyArrayObject *)values[1]);
    __pyx_v_templates = ((PyArrayObject *)values[2]);
    __pyx_v_amatrix = ((PyArrayObject *)values[3]);
    if (values[4]) {
      __pyx_v_toler = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_toler == (double)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_toler = ((double)1.e-4);
    }
    if (values[5]) {
      __pyx_v_MAXITER = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(values[5]);<span class='error_goto'> if (unlikely((__pyx_v_MAXITER == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    } else {
      __pyx_v_MAXITER = ((long)100000);
    }
    __pyx_v_verbose = values[6];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("run_nmf", 0, 4, 7, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.run_nmf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_bstruct_bvector.buf = NULL;
  __pyx_bstruct_coeffs.buf = NULL;
  __pyx_bstruct_flux.buf = NULL;
  __pyx_bstruct_variance.buf = NULL;
  __pyx_bstruct_templates.buf = NULL;
  __pyx_bstruct_amatrix.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_flux), __pyx_ptype_5numpy_ndarray, 1, "flux", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_variance), __pyx_ptype_5numpy_ndarray, 1, "variance", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_templates), __pyx_ptype_5numpy_ndarray, 1, "templates", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_amatrix), __pyx_ptype_5numpy_ndarray, 1, "amatrix", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_flux, (PyObject*)__pyx_v_flux, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_flux = __pyx_bstruct_flux.strides[0];
  __pyx_bshape_0_flux = __pyx_bstruct_flux.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_variance, (PyObject*)__pyx_v_variance, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_variance = __pyx_bstruct_variance.strides[0];
  __pyx_bshape_0_variance = __pyx_bstruct_variance.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_templates, (PyObject*)__pyx_v_templates, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_templates = __pyx_bstruct_templates.strides[0]; __pyx_bstride_1_templates = __pyx_bstruct_templates.strides[1];
  __pyx_bshape_0_templates = __pyx_bstruct_templates.shape[0]; __pyx_bshape_1_templates = __pyx_bstruct_templates.shape[1];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_amatrix, (PyObject*)__pyx_v_amatrix, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_amatrix = __pyx_bstruct_amatrix.strides[0]; __pyx_bstride_1_amatrix = __pyx_bstruct_amatrix.strides[1];
  __pyx_bshape_0_amatrix = __pyx_bstruct_amatrix.shape[0]; __pyx_bshape_1_amatrix = __pyx_bstruct_amatrix.shape[1];

  /* "unicorn/utils_c/interp_c.pyx":225
 * 
 * @cython.boundscheck(False)
 * def run_nmf(np.ndarray[DTYPE_t, ndim=1] flux, np.ndarray[DTYPE_t, ndim=1] variance, np.ndarray[DTYPE_t, ndim=2] templates, np.ndarray[DTYPE_t, ndim=2] amatrix, double toler=1.e-4, long MAXITER=100000, verbose=False):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """
 *     run_nmf(flux, variance, templates, amatrix, toler=1.e-4, MAXITER=100000, verbose=False)
 */
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_k_3 = __pyx_t_2;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_7unicorn_7utils_c_8interp_c_6run_nmf, NULL, __pyx_n_s_18);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__run_nmf, __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     """</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:     run_nmf(flux, variance, templates, amatrix, toler=1.e-4, MAXITER=100000, verbose=False)</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228: </pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:     Run the "NMF" fit to determine the non-negative coefficients of the `templates`</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     matrix that best-fit the observed `flux` and `variance` arrays.</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231: </pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:     `amatrix` is generated with the `prepare_nmf_amatrix` function.</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233: </pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:     e.g.</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235: </pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     &gt;&gt;&gt; coeffs = run_nmf(flux, variance, templates, amatrix)</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:     &gt;&gt;&gt; flux_fit = np.dot(coeffs.reshape((1,-1)), templates).flatten()</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:     &gt;&gt;&gt; chi2 = np.sum((flux-flux_fit)**2/variance)</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239: </pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:     --- Cythonified from eazy/getphotz.c (G. Brammer et al. 2008) ---</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:     """</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:     cdef unsigned long i,j,k,itcount,NTEMP</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:     cdef double tolnum,toldenom,tol</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:     cdef double vold,av</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:     cdef np.ndarray[DTYPE_t, ndim=1] bvector</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246: </pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:     cdef extern from "math.h":</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248:         double fabs(double)</pre>
<pre id='line248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249: </pre>
<pre id='line249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line250")'> 250:     NTEMP, NFILT = np.shape(templates)</pre>
<pre id='line250' class='code' style='background-color: #FFFF16'>
  /* "unicorn/utils_c/interp_c.pyx":250
 *         double fabs(double)
 * 
 *     NTEMP, NFILT = np.shape(templates)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #### Make Bvector
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_1, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_templates));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, ((PyObject *)__pyx_v_templates));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_templates));
  __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_3))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_3))) {
    PyObject* sequence = __pyx_t_3;
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      if (unlikely(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence) != 2)) {
        if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence) > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(<span class='py_macro_api'>PyTuple_GET_SIZE</span>(sequence));
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      if (unlikely(<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence) != 2)) {
        if (<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence) > 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
        else <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(<span class='py_macro_api'>PyList_GET_SIZE</span>(sequence));
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_5 = Py_TYPE(__pyx_t_4)->tp_iternext;
    index = 0; __pyx_t_1 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_1)) goto __pyx_L6_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L6_unpacking_failed;
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_5(__pyx_t_4), 2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L7_unpacking_done;
    __pyx_L6_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (<span class='py_c_api'>PyErr_Occurred</span>() && <span class='py_c_api'>PyErr_ExceptionMatches</span>(PyExc_StopIteration)) <span class='py_c_api'>PyErr_Clear</span>();
    if (!<span class='py_c_api'>PyErr_Occurred</span>()) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_L7_unpacking_done:;
  }
  __pyx_t_6 = __Pyx_<span class='py_c_api'>PyInt_AsUnsignedLong</span>(__pyx_t_1);<span class='error_goto'> if (unlikely((__pyx_t_6 == (unsigned long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 250; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_NTEMP = __pyx_t_6;
  __pyx_v_NFILT = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251: </pre>
<pre id='line251' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line252")'> 252:     #### Make Bvector</pre>
<pre id='line252' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF24' onclick='toggleDiv("line253")'> 253:     bvector = np.zeros(NTEMP, dtype=DTYPE)</pre>
<pre id='line253' class='code' style='background-color: #FFFF24'>
  /* "unicorn/utils_c/interp_c.pyx":253
 * 
 *     #### Make Bvector
 *     bvector = np.zeros(NTEMP, dtype=DTYPE)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     for i in range(NTEMP):
 *         bvector[i] = 0.;
 */
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMP);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), __pyx_t_4) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_2, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_bvector);
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_bvector, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack);
    if (unlikely(__pyx_t_8 <code><</code> 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_bvector, (PyObject*)__pyx_v_bvector, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
      }
    }
    __pyx_bstride_0_bvector = __pyx_bstruct_bvector.strides[0];
    __pyx_bshape_0_bvector = __pyx_bstruct_bvector.shape[0];
    if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 253; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_t_7 = 0;
  __pyx_v_bvector = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254:     for i in range(NTEMP):</pre>
<pre id='line254' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":254
 *     #### Make Bvector
 *     bvector = np.zeros(NTEMP, dtype=DTYPE)
 *     for i in range(NTEMP):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         bvector[i] = 0.;
 *         for k in range(NFILT):
 */
  __pyx_t_6 = __pyx_v_NTEMP;
  for (__pyx_t_12 = 0; __pyx_t_12 <code><</code> __pyx_t_6; __pyx_t_12+=1) {
    __pyx_v_i = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:         bvector[i] = 0.;</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":255
 *     bvector = np.zeros(NTEMP, dtype=DTYPE)
 *     for i in range(NTEMP):
 *         bvector[i] = 0.;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for k in range(NFILT):
 *             bvector[i]+=flux[k]*templates[i,k]/variance[k];
 */
    __pyx_t_13 = __pyx_v_i;
    *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_bvector.buf, __pyx_t_13, __pyx_bstride_0_bvector) = 0.;
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line256")'> 256:         for k in range(NFILT):</pre>
<pre id='line256' class='code' style='background-color: #FFFF7f'>
    /* "unicorn/utils_c/interp_c.pyx":256
 *     for i in range(NTEMP):
 *         bvector[i] = 0.;
 *         for k in range(NFILT):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             bvector[i]+=flux[k]*templates[i,k]/variance[k];
 * 
 */
    __pyx_t_14 = __Pyx_<span class='py_c_api'>PyInt_AsLong</span>(__pyx_v_NFILT);<span class='error_goto'> if (unlikely((__pyx_t_14 == (long)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    for (__pyx_t_15 = 0; __pyx_t_15 <code><</code> __pyx_t_14; __pyx_t_15+=1) {
      __pyx_v_k = __pyx_t_15;
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line257")'> 257:             bvector[i]+=flux[k]*templates[i,k]/variance[k];</pre>
<pre id='line257' class='code' style='background-color: #FFFFaa'>
      /* "unicorn/utils_c/interp_c.pyx":257
 *         bvector[i] = 0.;
 *         for k in range(NFILT):
 *             bvector[i]+=flux[k]*templates[i,k]/variance[k];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     #### Fit coefficients
 */
      __pyx_t_16 = __pyx_v_k;
      __pyx_t_17 = __pyx_v_i;
      __pyx_t_18 = __pyx_v_k;
      __pyx_t_19 = ((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_flux.buf, __pyx_t_16, __pyx_bstride_0_flux)) * (*__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_templates.buf, __pyx_t_17, __pyx_bstride_0_templates, __pyx_t_18, __pyx_bstride_1_templates)));
      __pyx_t_20 = __pyx_v_k;
      __pyx_t_21 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_variance.buf, __pyx_t_20, __pyx_bstride_0_variance));
      if (unlikely(__pyx_t_21 == 0)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_22 = __pyx_v_i;
      *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_bvector.buf, __pyx_t_22, __pyx_bstride_0_bvector) += (__pyx_t_19 / __pyx_t_21);
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258: </pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:     #### Fit coefficients</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2e' onclick='toggleDiv("line260")'> 260:     cdef np.ndarray[DTYPE_t, ndim=1] coeffs = np.ones(NTEMP, dtype=DTYPE)</pre>
<pre id='line260' class='code' style='background-color: #FFFF2e'>
  /* "unicorn/utils_c/interp_c.pyx":260
 * 
 *     #### Fit coefficients
 *     cdef np.ndarray[DTYPE_t, ndim=1] coeffs = np.ones(NTEMP, dtype=DTYPE)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     tol = 100
 * 
 */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_4, __pyx_n_s__ones);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_NTEMP);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__DTYPE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__dtype), __pyx_t_2) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_3, ((PyObject *)__pyx_t_1), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_23 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_coeffs, (PyObject*)__pyx_t_23, &__Pyx_TypeInfo_nn___pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_coeffs = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_bstruct_coeffs.buf = NULL;
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_bstride_0_coeffs = __pyx_bstruct_coeffs.strides[0];
      __pyx_bshape_0_coeffs = __pyx_bstruct_coeffs.shape[0];
    }
  }
  __pyx_t_23 = 0;
  __pyx_v_coeffs = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:     tol = 100</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":261
 *     #### Fit coefficients
 *     cdef np.ndarray[DTYPE_t, ndim=1] coeffs = np.ones(NTEMP, dtype=DTYPE)
 *     tol = 100             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     itcount=0;
 */
  __pyx_v_tol = 100.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262: </pre>
<pre id='line262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263:     itcount=0;</pre>
<pre id='line263' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":263
 *     tol = 100
 * 
 *     itcount=0;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     while (tol>toler) & (itcount<code><</code>MAXITER):
 *         tolnum=0.
 */
  __pyx_v_itcount = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264:     while (tol&gt;toler) &amp; (itcount&lt;MAXITER):</pre>
<pre id='line264' class='code' style='background-color: #FFFFff'>
  /* "unicorn/utils_c/interp_c.pyx":264
 * 
 *     itcount=0;
 *     while (tol>toler) & (itcount<code><</code>MAXITER):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         tolnum=0.
 *         toldenom = 0.
 */
  while (1) {
    __pyx_t_24 = ((__pyx_v_tol > __pyx_v_toler) & (__pyx_v_itcount <code><</code> __pyx_v_MAXITER));
    if (!__pyx_t_24) break;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265:         tolnum=0.</pre>
<pre id='line265' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":265
 *     itcount=0;
 *     while (tol>toler) & (itcount<code><</code>MAXITER):
 *         tolnum=0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         toldenom = 0.
 *         tol=0
 */
    __pyx_v_tolnum = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266:         toldenom = 0.</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":266
 *     while (tol>toler) & (itcount<code><</code>MAXITER):
 *         tolnum=0.
 *         toldenom = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         tol=0
 *         for i in range(NTEMP):
 */
    __pyx_v_toldenom = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:         tol=0</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":267
 *         tolnum=0.
 *         toldenom = 0.
 *         tol=0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for i in range(NTEMP):
 *             vold = coeffs[i];
 */
    __pyx_v_tol = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:         for i in range(NTEMP):</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":268
 *         toldenom = 0.
 *         tol=0
 *         for i in range(NTEMP):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             vold = coeffs[i];
 *             av = 0.;
 */
    __pyx_t_6 = __pyx_v_NTEMP;
    for (__pyx_t_12 = 0; __pyx_t_12 <code><</code> __pyx_t_6; __pyx_t_12+=1) {
      __pyx_v_i = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269:             vold = coeffs[i];</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":269
 *         tol=0
 *         for i in range(NTEMP):
 *             vold = coeffs[i];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             av = 0.;
 *             for j in range(NTEMP): av+=amatrix[i,j]*coeffs[j];
 */
      __pyx_t_15 = __pyx_v_i;
      __pyx_v_vold = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_coeffs.buf, __pyx_t_15, __pyx_bstride_0_coeffs));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:             av = 0.;</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":270
 *         for i in range(NTEMP):
 *             vold = coeffs[i];
 *             av = 0.;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             for j in range(NTEMP): av+=amatrix[i,j]*coeffs[j];
 *             #### Update coeffs in place
 */
      __pyx_v_av = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:             for j in range(NTEMP): av+=amatrix[i,j]*coeffs[j];</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":271
 *             vold = coeffs[i];
 *             av = 0.;
 *             for j in range(NTEMP): av+=amatrix[i,j]*coeffs[j];             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #### Update coeffs in place
 *             coeffs[i]*=bvector[i]/av;
 */
      __pyx_t_25 = __pyx_v_NTEMP;
      for (__pyx_t_26 = 0; __pyx_t_26 <code><</code> __pyx_t_25; __pyx_t_26+=1) {
        __pyx_v_j = __pyx_t_26;
        __pyx_t_27 = __pyx_v_i;
        __pyx_t_28 = __pyx_v_j;
        __pyx_t_29 = __pyx_v_j;
        __pyx_v_av = (__pyx_v_av + ((*__Pyx_BufPtrStrided2d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_amatrix.buf, __pyx_t_27, __pyx_bstride_0_amatrix, __pyx_t_28, __pyx_bstride_1_amatrix)) * (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_coeffs.buf, __pyx_t_29, __pyx_bstride_0_coeffs))));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:             #### Update coeffs in place</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line273")'> 273:             coeffs[i]*=bvector[i]/av;</pre>
<pre id='line273' class='code' style='background-color: #FFFFaa'>
      /* "unicorn/utils_c/interp_c.pyx":273
 *             for j in range(NTEMP): av+=amatrix[i,j]*coeffs[j];
 *             #### Update coeffs in place
 *             coeffs[i]*=bvector[i]/av;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             #tolnum+=np.abs(coeffs[i]-vold);
 *             tolnum+=fabs(coeffs[i]-vold);
 */
      __pyx_t_25 = __pyx_v_i;
      __pyx_t_21 = (*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_bvector.buf, __pyx_t_25, __pyx_bstride_0_bvector));
      if (unlikely(__pyx_v_av == 0)) {
        <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 273; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_t_26 = __pyx_v_i;
      *__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_coeffs.buf, __pyx_t_26, __pyx_bstride_0_coeffs) *= (__pyx_t_21 / __pyx_v_av);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274:             #tolnum+=np.abs(coeffs[i]-vold);</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:             tolnum+=fabs(coeffs[i]-vold);</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":275
 *             coeffs[i]*=bvector[i]/av;
 *             #tolnum+=np.abs(coeffs[i]-vold);
 *             tolnum+=fabs(coeffs[i]-vold);             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             toldenom+=vold;
 * 
 */
      __pyx_t_30 = __pyx_v_i;
      __pyx_v_tolnum = (__pyx_v_tolnum + fabs(((*__Pyx_BufPtrStrided1d(__pyx_t_7unicorn_7utils_c_8interp_c_DTYPE_t *, __pyx_bstruct_coeffs.buf, __pyx_t_30, __pyx_bstride_0_coeffs)) - __pyx_v_vold)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276:             toldenom+=vold;</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'>
      /* "unicorn/utils_c/interp_c.pyx":276
 *             #tolnum+=np.abs(coeffs[i]-vold);
 *             tolnum+=fabs(coeffs[i]-vold);
 *             toldenom+=vold;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         tol = tolnum/toldenom;
 */
      __pyx_v_toldenom = (__pyx_v_toldenom + __pyx_v_vold);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277: </pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line278")'> 278:         tol = tolnum/toldenom;</pre>
<pre id='line278' class='code' style='background-color: #FFFFaa'>
    /* "unicorn/utils_c/interp_c.pyx":278
 *             toldenom+=vold;
 * 
 *         tol = tolnum/toldenom;             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if verbose:
 */
    if (unlikely(__pyx_v_toldenom == 0)) {
      <span class='py_c_api'>PyErr_Format</span>(PyExc_ZeroDivisionError, "float division");
     <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_v_tol = (__pyx_v_tolnum / __pyx_v_toldenom);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279: </pre>
<pre id='line279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line280")'> 280:         if verbose:</pre>
<pre id='line280' class='code' style='background-color: #FFFFaa'>
    /* "unicorn/utils_c/interp_c.pyx":280
 *         tol = tolnum/toldenom;
 * 
 *         if verbose:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             print 'Iter #%d, tol=%.2e' %(itcount, tol)
 * 
 */
    __pyx_t_24 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_verbose);<span class='error_goto'> if (unlikely(__pyx_t_24 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 280; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    if (__pyx_t_24) {
</pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line281")'> 281:             print 'Iter #%d, tol=%.2e' %(itcount, tol)</pre>
<pre id='line281' class='code' style='background-color: #FFFF46'>
      /* "unicorn/utils_c/interp_c.pyx":281
 * 
 *         if verbose:
 *             print 'Iter #%d, tol=%.2e' %(itcount, tol)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         itcount+=1
 */
      __pyx_t_2 = <span class='py_c_api'>PyLong_FromUnsignedLong</span>(__pyx_v_itcount);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_tol);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
      __pyx_t_2 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_4), ((PyObject *)__pyx_t_1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
      if (<span class='pyx_c_api'>__Pyx_PrintOne</span>(0, ((PyObject *)__pyx_t_4)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 281; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      goto __pyx_L18;
    }
    __pyx_L18:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282: </pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:         itcount+=1</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'>
    /* "unicorn/utils_c/interp_c.pyx":283
 *             print 'Iter #%d, tol=%.2e' %(itcount, tol)
 * 
 *         itcount+=1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     return coeffs
 */
    __pyx_v_itcount = (__pyx_v_itcount + 1);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284: </pre>
<pre id='line284' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF32' onclick='toggleDiv("line285")'> 285:     return coeffs</pre>
<pre id='line285' class='code' style='background-color: #FFFF32'>
  /* "unicorn/utils_c/interp_c.pyx":285
 *         itcount+=1
 * 
 *     return coeffs             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * #
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_coeffs));
  __pyx_r = ((PyObject *)__pyx_v_coeffs);
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templates);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_coeffs);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_flux);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_amatrix);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_bvector);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_variance);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("unicorn.utils_c.interp_c.run_nmf", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_templates);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_coeffs);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_flux);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_amatrix);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_bvector);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_variance);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_bvector);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_NFILT);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_coeffs);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286: </pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287: #</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'></pre></body></html>
